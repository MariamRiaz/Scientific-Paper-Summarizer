{"sections": [{"heading": "1. Introduction", "text": "Deep neural networks (DNNs) are among the most powerful and versatile machine learning techniques, achieving state-of-the-art accuracy in a variety of important applications, such as visual object recognition (He et al., 2016),\n1Boston University, Boston, MA, USA 2Amazon, Cambridge, MA, USA 3Microsoft Research, Redmond, WA, USA. Correspondence to: Tolga Bolukbasi <tolgab@bu.edu>.\nProceedings of the 34 th International Conference on Machine Learning, Sydney, Australia, PMLR 70, 2017. Copyright 2017 by the author(s).\nspeech recognition (Hinton et al., 2012), and machine translation (Sutskever et al., 2014). However, the power of DNNs comes at a considerable cost, namely, the computational cost of applying them to new examples. This cost, often called the test-time cost, has increased rapidly for many tasks (see Fig. 1) with ever-growing demands for improved performance in state-of-the-art systems. As a point of fact, the Resnet152 (He et al., 2016) architecture with 152 layers, realizes a substantial 4.4% accuracy gain in top-5 performance over GoogLeNet (Szegedy et al., 2015) on the large-scale ImageNet dataset (Russakovsky et al., 2015) but is about 14X slower at test-time. The high test-time cost of state-of-the-art DNNs means that they can only be deployed on powerful computers, equipped with massive GPU accelerators. As a result, technology companies spend billions of dollars a year on expensive and power-hungry computer hardware. Moreover, high testtime cost prevents DNNs from being deployed on resource constrained platforms, such as those found in Internet of Things (IoT) devices, smart phones, and wearables. This problem has given rise to a concentrated research effort to reduce the test-time cost of DNNs. Most of the work on this topic focuses on designing more efficient network topologies and on compressing pre-trained models using various techniques (see related work below). We propose a different approach, which leaves the original DNN intact and instead changes the way in which we apply the DNN to new\nar X\niv :1\n70 2.\n07 81\n1v 2\n[ cs\n.L G\n] 1\n8 Se\np 20\n17\nexamples. We exploit the fact that natural data is typically a mix of easy examples and difficult examples, and we posit that the easy examples do not require the full power and complexity of a massive DNN.\nWe pursue two concrete variants of this idea. First, we propose an adaptive early-exit strategy that allows easy examples to bypass some of the network\u2019s layers. Before each expensive neural network layer (e.g., convolutional layers), we train a policy that determines whether the current example should proceed to the next layer, or be diverted to a simple classifier for immediate classification. Our second approach, an adaptive network selection method, takes a set of pre-trained DNNs, each with a different cost/accuracy trade-off, and arranges them in a directed acyclic graph (Trapeznikov & Saligrama, 2013; Wang et al., 2015), with the the cheapest model first and the most expensive one last. We then train an exit policy at each node in the graph, which determines whether we should rely on the current model\u2019s predictions or predict the most beneficial next branch to forward the example to. In this context we pose a global objective for learning an adaptive early exit or network selection policy and solve it by reducing the policy learning problem to a layer-by-layer weighted binary classification problem.\nWe demonstrate the merits of our techniques on the ImageNet object recognition task, using a number of popular pretrained DNNs. The early exit technique speeds up the average test-time evaluation of GoogLeNet (Szegedy et al., 2015), and Resnet50 (He et al., 2016) by 20-30% within reasonable accuracy margins. The network cascade achieves 2.8x speed-up compared to pure Resnet50 model at 1% top-5 accuracy loss and 1.9x speed-up with no change in model accuracy. We also show that our method can approximate a oracle policy that can see true errors suffered for each instance.\nIn addition to reducing the average test-time cost of DNNs, it is worth noting that our techniques are compatible with the common design of large systems of mobile devices, such as smart phone networks or smart surveillance-camera networks. These systems typically include a large number of resource-constrained edge devices that are connected to a central and resource-rich cloud. One of the main challenges involved in designing these systems is determining whether the machine-learned models will run in the devices or in the cloud. Offloading all of the work to the cloud can be problematic due to network latency, limited cloud ingress bandwidth, cloud availability and reliability issues, and privacy concerns. Our approach can be used to design such a system, by deploying a small inaccurate model and an exit policy on each device and a large accurate model in the cloud. Easy examples would be handled by the devices, while difficult ones would be forwarded to the cloud. Our\napproach naturally generalizes to a fog computing topology (where resource constrained edge devices are connected to a more powerful local gateway computer, which in turn is connected to a sequence of increasingly powerful computers along the path to the data-center). Such designs allow our method to be used in memory constrained settings as well due to offloading of complex models from the device."}, {"heading": "2. Related Work", "text": "Past work on reducing evaluation time of deep neural networks has centered on reductions in precision and arithmetic computational cost, design of efficient network structure, and compression or sparsification of networks to reduce the number of convolutions, neurons, and edges. The approach proposed in this paper is complimentary. Our approach does not modify network structure or training and can be applied in tandem with these approaches to further reduce computational cost.\nThe early efforts to compress large DNNs used a large teacher model to generate an endless stream of labeled examples for a smaller student model (Bucila et al., 2006; Hinton et al., 2015). The wealth of labeled training data generated by the teacher model allowed the small student model to mimic its accuracy.\nReduced precision networks (Gong et al., 2014; Courbariaux et al., 2015; Chen et al., 2015; Hubara et al., 2016a; Wu et al., 2016; Rastegari et al., 2016; Hubara et al., 2016b) have been extensively studied to reduce the memory footprint of networks and their test-time cost. Similarly, computationally efficient network structures have also been proposed to reduce the computational cost of deep networks by exploiting efficient operations to approximate complex functions, such as the inception layers introduced in GoogLeNet (Szegedy et al., 2015).\nNetwork sparsification techniques attempt to identify and prune away redundant parts of a large neural networks. A common approach is to remove unnecessary nodes/edges from the network(Liu et al., 2015; Iandola et al., 2016; Wen et al., 2016). In convolutional neural networks, the expensive convolution layers can be approximated (Bagherinezhad et al., 2016) and redundant computation can be avoided (Figurnov et al., 2016b).\nMore recently, researchers have designed spatially adaptive networks (Figurnov et al., 2016a; Bengio et al., 2015) where nodes in a layer are selectively activated. Others have developed cascade approaches (Leroux et al., 2017; Odena et al., 2017) that allow early exits based on confidence feedback. Our approach can be seen as an instance of conditional computation, where we seek computational gains through layer-by-layer and network-level early exits. However, we propose a general framework which opti-\nmizes a novel system risk that includes computational costs as well as accuracy. Our method does not require within layer modifications and works with directed acyclic graphs that allow multiple model evaluation paths.\nOur techniques for adaptive DNNs borrow ideas from the related sensor selection problem (Xu et al., 2013; Kusner et al., 2014; Wang et al., 2014; 2015; Trapeznikov & Saligrama, 2013; Nan et al., 2016; Wang & Saligrama, 2012). The goal of sensor selection is to adaptively choose sensor measurements or features for each example."}, {"heading": "3. Adaptive Early Exit Networks", "text": "Our first approach to reducing the test-time cost of deep neural networks is an early exit strategy. We first frame a global objective function and reduce policy training for optimizing the system-wide risk to a layer-by-layer weighted binary classification (WBC). We denote a labeled example as (x, y) \u2208 Rd \u00d7 {1, . . . ,L}, where d is the dimension of the data and {1, . . . ,L} is the set of classes represented in the data. We define the distribution generating the examples as X \u00d7 Y . For a predicted label y\u0302, we denote the loss L(y\u0302, y). In this paper, we focus on the task of classification and, for exposition, focus on the indicator loss L(y\u0302, y) = 1y\u0302=y , in this section. In practice we upper bound the indicator functions with logistic loss for computational efficiency.\nAs a running DNN example, we consider the AlexNet architecture (Krizhevsky et al., 2012), which is composed of 5 convolutional layers followed 3 fully connected layers. During evaluation of the network, computing each convolutional layer takes more than 3 times longer than computing a fully connected layer, so we consider a system that allows an example to exit the network after each of the first 4 convolutional layers. Let y\u0302(x) denote the label predicted by the network for example x and assume that computing this prediction takes a constant time of T . Moreover, let \u03c3k(x) denote the output of the kth convolutional layer for\nexample x and let tk denote the time it takes to compute this value (from the time that x is fed to the input layer). Finally, let y\u0302k(x) be the predicted label if we exit after the kth layer.\nAfter computing the kth convolutional layer, we introduce a decision function \u03b3k that determines whether the example should exit the network with a label of y\u0302k(x) or proceed to the next layer for further evaluation. The input to this decision function is the output of the corresponding convolutional layer \u03c3k(x), and the value of \u03b3k(\u03c3k(x)) is either \u22121 (indicating an early exit) or 1. This architecture is depicted on the right-hand side of Fig. 2.\nGlobally, our goal is to minimize the evaluation time of the network such that the error rate of the adaptive system is no more than some user-chosen value B greater than the full network:\nmin \u03b31,...,\u03b34 Ex\u223cX [T\u03b31,...,\u03b34(x)] . (1) s.t. E(x,y)\u223cX\u00d7Y [ (L(y\u0302\u03b31, ..., \u03b34(x), y)\u2212 L(y\u0302(x), y))+ ] \u2264 B\nHere, T\u03b31,...,\u03b34(x) is the prediction time for example x for the adaptive system, y\u0302\u03b31, ..., \u03b34(x) is the label predicted by the adaptive system for example x. In practice, the time required to predict a label and the excess loss introduced by the adaptive system can be recursively defined. As in (Wang et al., 2015) we can reduce the early exit policy training for minimizing the global risk to a WBC problem. The key idea is that, for each input, a policy must identify whether or not the future reward (expected future accuracy minus comp. loss) outweighs the current-stage accuracy.\nTo this end, we first focus on the problem of learning the decision function \u03b34, which determines if an example should exit after the fourth convolutional layer or whether it will be classified using the entire network. The time it takes to predict the label of example x depends on this de-\ncision and can be written as\nT4 (x, \u03b34) = { T + \u03c4(\u03b34) if \u03b34(\u03c34(x)) = 1 t4 + \u03c4(\u03b34) otherwise , (2)\nwhere \u03c4(\u03b34) is the computational time required to evaluate the function \u03b34. Our goal is to learn a system that trades-off the evaluation time and the induced error:\nargmin \u03b34\u2208\u0393 Ex\u223cX [T4(x, \u03b34)] + \u03bbE(x,y)\u223cX\u00d7Y\n[( L (y\u03024(x), y)\n\u2212 L (y\u0302(x), y) )\n+\n1\u03b34(\u03c34(x))=\u22121\n] (3)\nwhere (\u00b7)+ is the function(z)+ = max(z, 0) and \u03bb \u2208 R+ is a trade-off parameter that balances between evaluation time and error. Note that the function T4 (x, \u03b34) can be expressed as a sum of indicator functions:\nT4 (x, \u03b34) = (T + \u03c4(\u03b34))1\u03b34(\u03c34(x))=1\n+ (t4 + \u03c4(\u03b34))1\u03b34(\u03c34(x))=\u22121\n=T1\u03b34(\u03c34(x))=1 + t41\u03b34(\u03c34(x))=\u22121 + \u03c44(\u03b34)\nSubstituting for T4(x, \u03b34) allows us to reduce the problem to an importance weighted binary learning problem:\nargmin \u03b34\u2208\u0393\nE(x,y)\u223cX\u00d7Y [ C4(x, y)1\u03b34(\u03c34(x))6=\u03b24(x) ] + \u03c4(\u03b34)\n(4)\nwhere \u03b24(x) andC4(x, y) are the optimal decision and cost at stage 4 for the example (x, y) defined:\n\u03b24(x) =  \u22121 if T > ( t4 + \u03bb ( L (y\u03024(x), y) \u2212L (y\u0302(x), y) ) + ) 1 otherwise\nand C4(x, y) = \u2223\u2223T \u2212 t4 \u2212 \u03bb (L (y\u03024(x), y)\u2212 L (y\u0302(x), y))+\u2223\u2223 .\nNote that the regularization term, \u03c4(\u03b34), is important to choose the optimal functional form for the function \u03b34 as well as a natural mechanism to define the structure of the early exit system. Rather than limiting the family of function \u0393 to a single functional form such as a linear function or a specific network architecture, we assume the family of functions \u0393 is the union of multiple functional families, notably including the constant decision functions \u03b34(x) = 1,\u2200x \u2208 |X |. Although this constant function does not allow for adaptive network evaluation at the specific location, it additionally does not introduce any computational overhead, that is, \u03c4(\u03b34) = 0. By including this constant function in \u0393, we guarantee that our technique can only decrease the test-time cost.\nEmpirically, we find that the most effective policies operate on classifier confidences such as classification entropy. Specifically, we consider the family of functions \u0393 as the union of three functional families, the aforementioned constant functions, linear classifier on confidence features generated from linear classifiers applied to \u03c34(x), and linear classifier on confidence features generated from deep classifiers applied to \u03c34(x).\nRather than optimizing jointly over all three networks, we leverage the fact that the optimal solution to Eqn. (4) can be found by optimizing over each of the three families of functions independently. For each family of functions, the policy evaluation time \u03c4(\u03b34) is constant, and therefore solving (4) over a single family of functions is equivalent to solving an unregularized learning problem. We exploit this by solving the three unregularized learning problems and taking the minimum over the three solutions.\nIn order to learn the sequence of decision functions, we consider a bottom-up training scheme, as previously proposed in sensor selection (Wang et al., 2015). In this scheme, we learn the deepest (in time) early exit block first, then fix the outputs. Fixing the outputs of this trained function, we then train the early exit function immediately preceding the deepest early exit function (\u03b33 in Fig. 2).\nFor a general early exit system, we recursively define the future time, Tk(x, \u03b3k), and the future predicted label, y\u0303k(x, \u03b3k), as\nTk(x, \u03b3k) =  T + \u03c4(\u03b3k) if \u03b3k(\u03c3k(x)) = 1, k = K Tk+1(x, \u03b3k if \u03b3k(\u03c3k(x)) = 1, k < K +1) + \u03c4(\u03b3k)\ntk + \u03c4(\u03b3k) otherwise\nand\ny\u0303k(x, \u03b3k) =  y\u0302(x) if k = K + 1 y\u0302(x) if k = K and \u03b3k(\u03c3k(x)) = 1 y\u0303k+1(x, \u03b3k+1) if k < K\nand \u03b3k(\u03c3k(x)) = \u22121 y\u0302k(x) otherwise\n.\nUsing these definitions, we can generalize Eqn. (4). For a system with K early exit functions, the kth early exit function can be trained by solving the supervised learning problem:\nargmin \u03b3k\u2208\u0393\nE(x,y)\u223cX\u00d7Y [ Ck(x, y)1\u03b3k(x) 6=\u03b2k(\u03c3k(x)) ] + \u03c4(\u03b3k),\n(5)\nwhere optimal decision and cost \u03b2k(x) andCk(x, y) can be\ndefined:\n\u03b2k(x) =  \u22121 if k < K and Tk+1(x, \u03b3k+1) \u2265 tk+ \u03bb (L (y\u0302k(x), y)\u2212 L (y\u0303k+1(x), y))+ \u22121 if k = K and T \u2265 tk+ \u03bb (L (y\u0302k(x), y)\u2212 L (y\u0303k+1(x), y))+\n1 otherwise\nCk(x, y) =  \u2223\u2223\u2223Tk+1(x, \u03b3k+1)\u2212 tk if k < K \u2212\u03bb ( L (y\u0302k(x), y)\u2212 L (y\u0303k+1(x), y) ) + \u2223\u2223\u2223\u2223\u2223\u2223T \u2212 tk otherwise \u2212\u03bb (L (y\u0302k(x), y)\u2212 L (y\u0302(x), y))+ \u2223\u2223\u2223 .\nEqn. (5) allows for efficient training of an early exit system by sequentially training early exit decision functions from the bottom of the network upwards. Furthermore, by including constant functions in the family of functions \u0393 and training early exit functions in all potential stages of the system, the early exit architecture can also naturally be discovered. Finally, in the case of single option at each exit, the layer-wise learning scheme is equivalent to jointly optimizing all the exits with respect to full system risk."}, {"heading": "4. Network Selection", "text": "As shown in Fig. 1, the computational time has grown dramatically with respect to classification performance. Rather than attempting to reduce the complexity of the state-of-the-art networks, we instead leverage this nonlinear growth by extending the early exiting strategy to the regime of network selection. Conceptually, we seek to exploit the fact that many examples are correctly classified by relatively efficient networks such as alexnet and googlenet, whereas only a small fraction of examples are correctly classified by computationally expensive networks such as resnet 152 and incorrectly classified by googlenet and alexnet.\nAs an example, assume we have three pre-trained networks, N1, N2, and N3. For an example x, denote the predictions for the networks as N1(x), N2(x), and N3(x). Additionally, denote the evaluation times for each of the networks as \u03c4(N1), \u03c4(N2), and \u03c4(N3).\nAs in Fig. 2, the adaptive system composed of two decision functions that determine which network is evaluated for each example. First, \u03ba1 : |X | \u2192 {N1, N2, N3} is applied after evaluation of N1 to determine if the classification decision from N1 should be returned or if network N2 or network N3 should be evaluated for the example. For examples that are evaluated on N2, \u03ba2 : |X | \u2192 {N2, N3} determines if the classification decision from N2 should be returned or if network N3 should be evaluated.\nOur goal is to learn the functions \u03ba1 and \u03ba2 that minimize the average evaluation time subject to a constraint on the average loss induced by adaptive network selection. As in the adaptive early exit case, we first learn \u03ba2 to trade-off between the average evaluation time and induced error:\nmin \u03ba2\u2208\u0393\nEx\u223cX [ \u03c4(N3)1\u03ba2(x)=N3 ] + \u03c4(\u03ba2)\n+ \u03bbE(x,y)\u223cX\u00d7Y [( L (N2(x), y)\n\u2212 L (N3(x), y) )\n+ 1\u03ba2(x)=N2\n] , (6)\nwhere \u03bb \u2208 R+ is a trade-off parameter. As in the adaptive network usage case, this problem can be posed as an importance weighted supervised learning problem:\nmin \u03ba2\u2208\u0393\nE(x,y)\u223cX\u00d7Y [ W2(x, y)1\u03ba2(x)6=\u03b82(x) ] + \u03c4(\u03ba2), (7)\nwhere \u03b82(x) andW2(x, y) are the cost and optimal decision at stage 4 for the example/label pair (x, y) defined:\n\u03b82(x) = { N2 if \u03c4(N3) > \u03bb (L (N3(x), y)\u2212 L (N2(x), y))+ N3 otherwise\nand W2(x, y) = \u2223\u2223\u2223\u03c4(N3)\u2212 \u03bb (L (N2(x), y)\u2212 L (N3(x), y))+ \u2223\u2223\u2223.\nOnce \u03ba2 has been trained according to Eqn. (7), the training times for examples that pass through N2 and are routed by \u03ba2 can be defined T\u03ba2(x) = \u03c4(N2) + \u03c4(\u03ba2) + \u03c4(N3)1\u03ba2(x)=N3 . As in the adaptive early exit case, we train and fix the last decision function, \u03ba2, then train the earlier function, \u03ba1. As before, we seek to trade-off between evaluation time and error:\nmin \u03ba1\u2208\u0393\nEx\u223cX [ \u03c4(N3)1\u03ba1(x)=N3 + \u03c4(N2)1\u03ba1=N2 ] + \u03c4(\u03ba1)+\n\u03bbE(x,y)\u223cX\u00d7Y [ (L (N2(x), y)\u2212 L (N3(x), y))+ 1\u03ba1(x)=N2\n+ (L (N1(x), y)\u2212 L (N3(x), y))+ 1\u03ba1(x)=N1\n] (8)\nThis can be reduced to a cost sensitive learning problem:\nmin \u03ba1\u2208\u0393 E(x,y)\u223cX\u00d7Y\n[ R3(x, y)1\u03ba1(x)=N3 +R2(x, y)1\u03ba1(x)=N2\n+R1(x, y)1\u03ba1(x)=N1 ] + \u03c4(\u03ba1), (9)\nwhere the costs are defined:\nR1(x, y) = (L(N1(x), y)\u2212 L(N3(x), y))+ R2(x, y) = (L(N2(x), y)\u2212 L(N3(x), y))+ + \u03c4(N2) R3(x, y) = \u03c4(N3).\nAlgorithm 1 Adaptive Network Learning Pseudocode Input: Data: (xi, yi)ni=1, Models S, routes, E, model costs \u03c4(.)), while \u2203 untrained \u03c0 do\n(1) Choose the deepest policy decision j, s.t. all downstream policies are trained for example i \u2208 {1, . . . , n} do\n(2) Construct the weight vector ~wi of costs per action from Eqn. (7).\nend for (3) \u03c0j \u2190Learn clf.((x1, ~w1), . . . , (xn, ~wn)) (4) Evaluate \u03c0j and update route costs to model j: C(xi, yi, sn, sj)\u2190 ~wji (\u03c0j(xi)) + C(xi, yi, sn, sj)\nend while (5) Prune models the policy does not route any example to from the collection Output: Policy functions, \u03c01, . . . , \u03c0K"}, {"heading": "5. Experimental Section", "text": "We evaluate our method on the Imagenet 2012 classification dataset (Russakovsky et al., 2015) which has 1000 object classes. We train using the 1.28 million training images and evaluate the system using 50k validation images. We use the pre-trained models from Caffe Model Zoo for Alexnet, GoogLeNet and Resnet50 (Krizhevsky et al., 2012; Szegedy et al., 2015; He et al., 2016). For preprocessing we follow the same routines proposed for these networks and verify the final network performances within a small margin (< 0.1%). Note that it is common to use ensembles of networks and multiple crops to achieve maximum performance. These methods add minimal gain in accuracy while increasing the system cost dramatically. As the speedup margin increases, it becomes trivial for the policy to show significant speedups within the same accuracy tolerance. We believe such speedups are not useful in practice and focus on single crop with single model case.\nTemporal measurements: We measure network times using the built-in tool in the Caffe library on a server that utilizes a Nvidia Titan X Pascal with CuDNN 5. Since our focus is on the computational cost of the networks, we ignore the data loading and preprocessing times. The reported times are actual measurements including the policy overhead.\nPolicy form and meta-features: In addition to the outputs of the convolutional layers of earlier networks, we augment the feature space with the entropy of prediction probabilities. We relax the indicators in equations (5) and (9) learn linear logistic regression model on these features for our policy. We experimented with pooled internal representations, but in practice, inclusion of the entropy feature with\na simple linear policy significantly outperforms more complex policy functions that exclude the entropy feature."}, {"heading": "5.1. Network Selection", "text": "Baselines: Our full system, depicted in Figure 2, starts with Alexnet. Following the evaluation of Alexnet, the system determines for each example either to return the prediction, route the example to GoogLeNet, or route the example to Resnet50. For examples that are routed to GoogLeNet, the system either returns the prediction output by GoogLeNet or routes the example to Resnet50. As baselines, we compare against a uniform policy and a myopic policy which learns a single threshold based on model confidence. We also report performance from different system topologies. To provide a bound on the achievable performance, we show the performance of a soft oracle. The soft oracle has access to classification labels and sends each example to the fastest model that correctly classifies the example. Since having access to the labels is too strong, we made the oracle softer by adding two constraints. First, it follows the same network topology, also it can not make decisions without observing the model feedback first, getting hit by the same overhead. Second, it can only exit at a cheaper model if all latter models agree on the true label. This second constraint is added due to the fact that our goal is not to improve the prediction performance of the system but to reduce the computational time, and therefore we prevent the oracle from \u201ccorrecting\u201d mistakes made by the most complex networks.\nWe sweep the cost trade-off parameter in the range 0.0 to 0.1 to achieve different budget points. Note that due to weights in our cost formulation, even when the pseudo labels are identical, policy behavior can differ. Conceptually, the weights balance the importance of the samples that gain in classification loss in future stages versus samples that gain in computational savings by exiting early stages.\nThe results are demonstrated in Figure 3. We see that both full tree and a->g->r50 cascade achieve significant (2.8x) speedup over using Resnet50 while maintaining its accuracy within 1%. The classifier feedback for the policy has a dramatic impact on its performance. Although, Alexnet introduces much less overhead compared to GoogLeNet (\u22480.2 vs \u22480.7), the a->r50 policy performs significantly worse in lower budget regions. Our full tree policy learns to choose the best order for all budget regions. Furthermore, the policy matches the soft oracle performance in both the high and low budget regions.\nNote that GoogLeNet is a very well positioned at 0.7ms per image budget, probably due to its efficiency oriented architectural design with inception blocks (Szegedy et al., 2015). For low budget regions, the overhead of the policy is a detriment, as even when it can learn to send al-\nmost half the samples to Alexnet instead of GoogLeNet with marginal loss in accuracy, the extra 0.23ms Alexnet overhead brings the balance point, \u2248 0.65ms, very close to using only GoogLeNet at 0.7ms. The ratio between network evaluation times is a significant factor for our system. Fortunately, as mentioned before, for many applications the ratio of different models can be very high (cloud computing upload times, resnet versus Alexnet difference etc.).\nWe further analyzed the network usage and runtime proportion statistics for samples at different budget regions. Fig. 4 demonstrates the results at three different budget levels. Full tree policy avoids using GoogLeNet altogether for high budget regions. This is the expected behavior since the a->r50 policy performs just as well in those regions and using GoogLeNet in the decision adds too much overhead. At mid level budgets the policy distributes samples more evenly. Note that the sum of the overheads is close to useful runtime of cheaper networks in this region. This is possible\nsince the earlier networks are very lightweight."}, {"heading": "5.2. Network Early Exits", "text": "To output a prediction following each convolutional layer, we train a single layer linear classifier after a global average pooling for each layer. We added global pooling to minimize the policy overhead in earlier exits. For Resnet50 we added an exit after output layers of 2a, 2c, 3a, 3d, 4a and 4f. The dimensionality of the exit features after global average pooling are 256, 256, 512, 512, 1024 and 1024 in the same order as the layer names. For GoogLeNet we added the exits after concatenated outputs of every inception layer.\nTable 1 shows the early exit performance for different networks. The gains are more marginal compared to network selection. Fig 5 shows the accuracy gains per evaluation time for different layers. Interestingly, the accuracy gain per time is more linear within the same architecture com-"}, {"heading": "5.3. Network Error Analysis", "text": "Fig. 6 shows the distributions over examples of the networks that correctly label the example. Notably, 50% and 77% of the examples are correctly classified by all networks for top 1 and top 5 error, respectively. Similarly, 18% and 5% of the examples are incorrectly classified by all networks with respect to their top 1 and top 5 error, respectively. These results verify our hypothesis that for a large fraction of data, there is no need for costly networks. In particular, for the 68% and 82% of data with no change\nin top 1 and top 5 error, respectively, the use of any network apart from Alexnet is unnecessary and only adds unnecessary computational time.\nAdditionally, it is worth noting the balance between examples incorrectly classified by all networks, 18% and 5% respectively for top 1 and top 5 error, and the fraction of examples correctly classified by either GoogLeNet or Resnet but not Alexnet, 25.1% and 15.1% for top 1 and top 5 error, respectively. This behavior supports our observation that entropy of classification decisions is an important feature in making policy decisions, as examples likely to be incorrectly classified by Alexnet are likely to be classified correctly by a later network.\nNote that our system is trained using the same data used to train the networks. Generally, the resulting evaluation error for each network on training data is significantly lower than error that arises on test data, and therefore our system is biased towards sending examples to more complex networks that generally show negligible training error. Practically, this problem is alleviated through the use of validation data to train the adaptive systems. In order to maintain the reported performance of the network without expansion of the training set, we instead utilize the same data for training both networks and adaptive systems, however we note that performance of our adaptive systems is generally better when trained on data excluded from the network training."}, {"heading": "6. Conclusion", "text": "We proposed two different schemes to adaptively trade off model accuracy with model evaluation time for deep neural networks. We demonstrated that significant gains in computational time is possible through our novel policy with negligible loss in accuracy on ImageNet image recognition dataset. We posed a global objective for learning an adaptive early exit or network selection policy and solved it by reducing the policy learning problem to a layer-bylayer weighted binary classification problem. We believe that adaptivity is very important in the age of growing data for models with high variance in computational time and quality. We also showed that our method approximates an Oracle based policy that has benefit of access to true error for each instance from all the networks."}, {"heading": "Acknowledgements", "text": "This material is based upon work supported in part by NSF Grants CCF: 1320566, NSF Grant CNS: 1330008 NSF CCF: 1527618, the U.S. Department of Homeland Security, Science and Technology Directorate, Office of University Programs, under Grant Award 2013-ST-061-ED0001, and by ONR contract N00014-13-C-0288. The views and conclusions contained in this document are those of the authors and should not be interpreted as necessarily representing the social policies, either expressed or implied, of the NSF, U.S. DHS, ONR or AF."}], "year": 2017, "references": [{"title": "Lcnn: Lookup-based convolutional neural network", "authors": ["Bagherinezhad", "Hessam", "Rastegari", "Mohammad", "Farhadi", "Ali"], "venue": "arXiv preprint arXiv:1611.06473,", "year": 2016}, {"title": "Conditional computation in neural networks for faster models", "authors": ["Bengio", "Emmanuel", "Bacon", "Pierre-Luc", "Pineau", "Joelle", "Precup", "Doina"], "venue": "arXiv preprint arXiv:1511.06297,", "year": 2015}, {"title": "Compressing neural networks with the hashing trick", "authors": ["Chen", "Wenlin", "Wilson", "James T", "Tyree", "Stephen", "Weinberger", "Kilian Q", "Yixin"], "venue": "In ICML,", "year": 2015}, {"title": "JeanPierre. Binaryconnect: Training deep neural networks with binary weights during propagations", "authors": ["Courbariaux", "Matthieu", "Bengio", "Yoshua", "David"], "venue": "In Advances in Neural Information Processing Systems,", "year": 2015}, {"title": "Spatially adaptive computation time for residual networks", "authors": ["Figurnov", "Michael", "Collins", "Maxwell D", "Zhu", "Yukun", "Zhang", "Li", "Huang", "Jonathan", "Vetrov", "Dmitry", "Salakhutdinov", "Ruslan"], "venue": "arXiv preprint arXiv:1612.02297,", "year": 2016}, {"title": "Perforatedcnns: Acceleration through elimination of redundant convolutions", "authors": ["Figurnov", "Mikhail", "Ibraimova", "Aizhan", "Vetrov", "Dmitry P", "Kohli", "Pushmeet"], "venue": "In Advances in Neural Information Processing Systems,", "year": 2016}, {"title": "Compressing deep convolutional networks using vector quantization", "authors": ["Gong", "Yunchao", "Liu", "Yang", "Ming", "Bourdev", "Lubomir"], "venue": "arXiv preprint arXiv:1412.6115,", "year": 2014}, {"title": "Deep residual learning for image recognition", "authors": ["He", "Kaiming", "Zhang", "Xiangyu", "Ren", "Shaoqing", "Sun", "Jian"], "venue": "In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition,", "year": 2016}, {"title": "Distilling the knowledge in a neural network", "authors": ["Hinton", "Geoffrey", "Vinyals", "Oriol", "Dean", "Jeff"], "venue": "arXiv preprint arXiv:1503.02531,", "year": 2015}, {"title": "Binarized neural networks", "authors": ["Hubara", "Itay", "Courbariaux", "Matthieu", "Soudry", "Daniel", "ElYaniv", "Ran", "Bengio", "Yoshua"], "venue": "In Advances in Neural Information Processing Systems,", "year": 2016}, {"title": "Quantized neural networks: Training neural networks with low precision weights and activations", "authors": ["Hubara", "Itay", "Courbariaux", "Matthieu", "Soudry", "Daniel", "ElYaniv", "Ran", "Bengio", "Yoshua"], "venue": "arXiv preprint arXiv:1609.07061,", "year": 2016}, {"title": "Squeezenet: Alexnet-level accuracy with 50x fewer parameters and< 0.5 mb model size", "authors": ["Iandola", "Forrest N", "Han", "Song", "Moskewicz", "Matthew W", "Ashraf", "Khalid", "Dally", "William J", "Keutzer", "Kurt"], "venue": "arXiv preprint arXiv:1602.07360,", "year": 2016}, {"title": "Imagenet classification with deep convolutional neural networks. In Advances in neural information processing", "authors": ["Krizhevsky", "Alex", "Sutskever", "Ilya", "Hinton", "Geoffrey E"], "year": 2012}, {"title": "Feature-cost sensitive learning with submodular trees of classifiers", "authors": ["M Kusner", "W Chen", "Q Zhou", "Z Xu", "K Weinberger", "Y. Chen"], "venue": "In Twenty-Eighth AAAI Conference on Artificial Intelligence,", "year": 2014}, {"title": "The cascading neural network: building the internet of smart things", "authors": ["Leroux", "Sam", "Bohez", "Steven", "De Coninck", "Elias", "Verbelen", "Tim", "Vankeirsbilck", "Bert", "Simoens", "Pieter", "Dhoedt", "Bart"], "venue": "Knowledge and Information Systems,", "year": 2017}, {"title": "Sparse convolutional neural networks", "authors": ["Liu", "Baoyuan", "Wang", "Min", "Foroosh", "Hassan", "Tappen", "Marshall", "Pensky", "Marianna"], "venue": "In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition,", "year": 2015}, {"title": "Pruning random forests for prediction on a budget", "authors": ["Nan", "Feng", "Wang", "Joseph", "Saligrama", "Venkatesh"], "venue": "In Advances in Neural Information Processing Systems 29: Annual Conference on Neural Information Processing Systems", "year": 2016}, {"title": "Changing model behavior at test-time using reinforcement learning", "authors": ["Odena", "Augustus", "Lawson", "Dieterich", "Olah", "Christopher"], "venue": "arXiv preprint arXiv:1702.07780,", "year": 2017}, {"title": "Xnor-net: Imagenet classification using binary convolutional neural networks", "authors": ["Rastegari", "Mohammad", "Ordonez", "Vicente", "Redmon", "Joseph", "Farhadi", "Ali"], "venue": "In European Conference on Computer Vision,", "year": 2016}, {"title": "Sequence to sequence learning with neural networks. In Advances in neural information processing", "authors": ["Sutskever", "Ilya", "Vinyals", "Oriol", "Le", "Quoc V"], "year": 2014}, {"title": "Supervised sequential classification under budget constraints", "authors": ["K Trapeznikov", "V. Saligrama"], "venue": "In International Conference on Artificial Intelligence and Statistics,", "year": 2013}, {"title": "Model selection by linear programming", "authors": ["J. Wang", "T. Bolukbasi", "K. Trapeznikov", "V. Saligrama"], "venue": "In European Conference on Computer Vision, pp", "year": 2014}, {"title": "Local supervised learning through space partitioning", "authors": ["Wang", "Joseph", "Saligrama", "Venkatesh"], "venue": "In Advances in Neural Information Processing Systems (NIPS),", "year": 2012}, {"title": "Efficient learning by directed acyclic graph for resource constrained prediction", "authors": ["Wang", "Joseph", "Trapeznikov", "Kirill", "Saligrama", "Venkatesh"], "venue": "In Advances in Neural Information Processing Systems,", "year": 2015}, {"title": "Learning structured sparsity in deep neural networks", "authors": ["Wen", "Wei", "Wu", "Chunpeng", "Wang", "Yandan", "Chen", "Yiran", "Li", "Hai"], "venue": "In Advances in Neural Information Processing Systems,", "year": 2016}, {"title": "Quantized convolutional neural networks for mobile devices", "authors": ["Wu", "Jiaxiang", "Leng", "Cong", "Wang", "Yuhang", "Hu", "Qinghao", "Cheng", "Jian"], "venue": "In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition,", "year": 2016}, {"title": "Costsensitive tree of classifiers", "authors": ["Z. Xu", "M. Kusner", "M. Chen", "K. Weinberger"], "venue": "In Proceedings of the 30th International Conference on Machine Learning,", "year": 2013}], "id": "SP:05592f39daaab91e6a3230a2e096a635539e7d98", "authors": [{"name": "Tolga Bolukbasi", "affiliations": []}, {"name": "Joseph Wang", "affiliations": []}, {"name": "Ofer Dekel", "affiliations": []}, {"name": "Venkatesh Saligrama", "affiliations": []}], "abstractText": "We present an approach to adaptively utilize deep neural networks in order to reduce the evaluation time on new examples without loss of accuracy. Rather than attempting to redesign or approximate existing networks, we propose two schemes that adaptively utilize networks. We first pose an adaptive network evaluation scheme, where we learn a system to adaptively choose the components of a deep network to be evaluated for each example. By allowing examples correctly classified using early layers of the system to exit, we avoid the computational time associated with full evaluation of the network. We extend this to learn a network selection system that adaptively selects the network to be evaluated for each example. We show that computational time can be dramatically reduced by exploiting the fact that many examples can be correctly classified using relatively efficient networks and that complex, computationally costly networks are only necessary for a small fraction of examples. We pose a global objective for learning an adaptive early exit or network selection policy and solve it by reducing the policy learning problem to a layerby-layer weighted binary classification problem. Empirically, these approaches yield dramatic reductions in computational cost, with up to a 2.8x speedup on state-of-the-art networks from the ImageNet image recognition challenge with minimal (< 1%) loss of top5 accuracy.", "title": "Adaptive Neural Networks for Efficient Inference"}