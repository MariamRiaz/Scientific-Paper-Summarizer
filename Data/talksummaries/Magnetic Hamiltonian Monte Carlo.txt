0	16	Probabilistic inference in complex models generally requires the evaluation of intractable, high-dimensional integrals.
1	58	One powerful and generic approach to inference is to use Markov chain Monte Carlo (MCMC) methods to generate asymptotically exact (but correlated) samples from a posterior distribution for inference and learning.
2	33	Hamiltonian Monte Carlo (HMC) (Duane et al., 1987; Neal, 2011) is a state-of-the-art MCMC method which uses gradient information from an absolutely continuous target density to encourage efficient sampling and exploration.
3	31	Crucially, HMC utilizes proposals inspired by Hamiltonian dynamics (corresponding to the classical mechanics of a point particle) which can traverse long distances in parameter space.
4	28	HMC, and variants like NUTS (which eliminates the need to hand-tune the algorithm’s hyperparameters), have been successfully applied to a large class of probabilistic inference problems where they are often the gold standard for (asymptotically) exact inference (Neal, 1996; Hoffman & Gelman, 2014; Carpenter et al., 2016).
5	7	In this paper, we first review important properties of Hamiltonian dynamics, namely energy-preservation, symplecticity, and time-reversibility, and derive a more general class of dynamics with these properties which we refer to as noncanonical Hamiltonian dynamics.
6	16	We then discuss the relationship of non-canonical Hamiltonian dynamics to wellknown variants of HMC and propose a novel extension of HMC.
8	7	Furthermore, we construct an explicit, symplectic, leapfroglike integrator for magnetic HMC which allows for an efficient numerical integration scheme comparable to that of ordinary HMC.
17	25	For the remainder of the paper, we take the distribution over the momentum variables to be Gaussian, as is common in the literature (indeed, there is evidence that in many cases, the choice of a Gaussian distribution may be optimal (Betancourt, 2017)).
24	41	From this, the acceptance ratio in step (iii) enforcing detailed balance can be shown (see e.g. (Green, 1995)) to have the form: min ( 1, exp(−H(θ̃n+1, p̃n+1)) exp(−H(θn,pn)) ∣∣∣det∇θ,pΦ̃τ,H(θn,pn)∣∣∣) .
31	30	Typically, the leapfrog (Störmer-Verlet) integrator is used since it is an explicit method that is both symplectic and time-reversible (Neal, 2011).
32	101	One elegant way to motivate this integrator is by decomposing the Hamiltonian into a symmetric splitting: H(θ,p) = U(θ)/2︸ ︷︷ ︸ H1(θ) + p>p/2︸ ︷︷ ︸ H2(p) +U(θ)/2︸ ︷︷ ︸ H1(θ) (4) and then defining Φ ,H1(θ) and Φ ,H2(p) to be the exactlyintegrated flows for the sub-Hamiltonians H1(θ) and Hamiltonian flow associated withH for time τ .
38	19	The leapfrog scheme will not exactly preserve the Hamiltonian H , so the remaining acceptance ratio exp(H(θn,pn) − H(θ̃n+1, p̃n+1)) must be calculated.
42	23	In this section, we develop the properties of a general class of flows we refer to as non-canonical Hamiltonian systems that parallel these properties, we use to construct our method magnetic HMC (see Algorithm 1): Lemma 1.
43	8	The map ΦAτ,H(θ,p) defined by integrating the non-canonical Hamiltonian system d dt [ θ(t) p(t) ] = A∇θ,pH(θ(t),p(t)) (7) with initial conditions (θ,p) for time τ , where A ∈ M2n×2n is any invertible, antisymmetric matrix induces a flow on the coordinates (θ,p) that is still energyconserving (∂τH(ΦAτ,H(θ,p)) = 0) and symplectic with respect to A ([∇θ,pΦτ,H(θ,p)]>A−1[∇θ,pΦτ,H(θ,p)] = A−1) which also implies volume-preservation of the flow.
45	22	The statement of Lemma 1 is simply a restatement of this fact grounded in a coordinate system.
47	9	Our second observation is that the dynamics in (7) are not time-reversible in the traditional sense.
61	7	As with standard HMC, exactly simulating the flow ΦAτ,H is rarely tractable, and a numerical integrator is required to approximate the flow.
73	7	(13) Henceforth we will always take E = 0 when we use Φfrog,A ,H(θ,p) to generate leapfrog proposals, which interestingly corresponds to a magnetic dynamics as discussed in Lemma 4.
75	5	Here, we describe several tractable subcases of the general formulation of non-canonical Hamiltonian dynamics since these they have interesting physical interpretations.
76	27	One simple variant of HMC is preconditioned HMC where p ∼ N (0,M) (Neal, 2011), and can be implemented nearly identically to ordinary HMC.
77	24	We note that preconditioning can be recovered within our framework using a simple form for the non-canonical A matrix: Lemma 3. i) Preconditioned HMC with momentum variable p ∼ N (0,M) in the (θ,p) coordinates is exactly equivalent to simulating non-canonical HMC with p′ = M−1/2p ∼ N (0, I) and the non-canonical matrix A = Magnetic Hamiltonian Monte Carlo[ 0 M1/2 −(M1/2)> 0 ] , and then transforming back to (θ,p) coordinates using p = M1/2p′.
79	15	Lemma 3 illustrates a fact alluded to in (Neal, 2011); using a mass preconditioning matrix M and a change of basis given by matrix −(M−1/2)> acting on θ leaves the HMC algorithm invariant.
82	115	Secondly, the dynamics have an interesting physical interpretation quite distinct from mass preconditioning and other HMC variants like Riemannian HMC (Girolami et al., 2009): Lemma 4.
83	69	In 3 dimensions the non-canonical Hamiltonian dynamics corresponding to the Hamiltonian H(θ,p) = U(θ) + 12p >p and A matrix as in (14) are equivalent to the Newtonian mechanics of a charged particle (with unit mass and charge) coupled to a magnetic field ~B (given by a particular function of G - see Appendix): d 2θ dt2 = −∇θU(θ) + dθdt × ~B.
85	32	However, in light of Lemma 3 we might wonder if by a clever rewriting of the Hamiltonian we can reproduce this system of ODEs using the canonical A matrix (i.e. E = G = 0, F = I).
86	38	This is not the case: Lemma 5.
88	26	Using the results discussed in Section 3 and Section 3.1 we can now propose Magnetic HMC – see Algorithm 1.
90	117	, N do Resample pn−1 ∼ N(0, I) Set (θ̃n, p̃n) ← LF(H,L, , (θn−1,pn−1,Gn−1)) with ΦA ,H2(p) as in (11) Flip momentum (θ̃n, p̃n) ← (θ̃n,−p̃n) and set G̃n ← −Gn−1 if Unif([0, 1]) < min(1, exp(H(θn−1,pn−1) − H(θ̃n, p̃n))) then Set (θn,pn,Gn)← (θ̃n, p̃n, G̃n) else Set (θn,pn,Gn)← (θn−1,pn−1,Gn−1) end if Flip momentum pn ← −pn and flip Gn ← −Gn end for Output: (θn)Nn=0 One further remark is that by construction the integrator for magnetic HMC is expected to have similarly good energy conservation properties to the integrator of standard HMC: Lemma 6.
95	110	If we regard G as an element in the Lie algebra of antisymmetric matrices, which can be thought of as infinitesimal rotations, then the exponential map exp(G ) will project this transformation into the Lie group of real orthogonal linear maps.
