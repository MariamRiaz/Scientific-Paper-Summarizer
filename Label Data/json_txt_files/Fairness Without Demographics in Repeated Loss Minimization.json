{"sections": [{"heading": "1. Introduction", "text": "Consider a speech recognizer that is deployed to millions of users. State-of-the art speech recognizers achieve high overall accuracy, yet it is well known that such systems have systematically high errors on minority accents (Amodei et al., 2016). We refer to this phenomenon of high overall accuracy but low minority accuracy as a representation disparity, which is the result of optimizing for average loss. This representation disparity forms our definition of unfairness, and has been observed in face recognition (Grother et al., 2011), language identification (Blodgett et al., 2016;\n1Department of Computer Science, Stanford, USA 2Department of Statistics, Stanford, USA 3Management Science & Engineering, Stanford, USA. Correspondence to: Tatsunori Hashimoto <thashim@stanford.edu>.\nProceedings of the 35 th International Conference on Machine Learning, Stockholm, Sweden, PMLR 80, 2018. Copyright 2018 by the author(s).\nJurgens et al., 2017), dependency parsing (Blodgett et al., 2016), part-of-speech tagging (Hovy & Sgaard, 2015), academic recommender systems (Sapiezynski et al., 2017), and automatic video captioning (Tatman, 2017).\nMoreover, a minority user suffering from a higher error rate will become discouraged and more likely to stop using the system, thus no longer providing data to the system. As a result, the minority group will shrink and might suffer even higher error rates from a retrained model in a future time step. Machine learning driven feedback loops have been observed in predictive policing (Fuster et al., 2017) and credit markets (Fuster et al., 2017), and this problem of disparity amplification is a possibility in any deployed machine learning system that is retrained on user data.\nIn this paper, we aim to mitigate the representation disparity problem and its amplification through time. We focus on the following setting: at each time step, each user interacts with the current model and incurs some loss, based on which she decides to keep or quit using the service. A model is trained on the resulting user data which is used at the next time step. We assume that each user comes from one of K groups, and our goal is to minimize the worst case risk of any group across time. However, the group membership and number of groups K are both unknown, as full demographic information is likely missing in real online services.\nWe first show that empirical risk minimization (ERM) does not control the worst-case risk over the disparate K groups and show examples where ERM turns initially fair models unfair (Section 3). To remedy this issue, we propose the use of distributionally robust optimization (DRO) (Section 4). Given a lower bound on the smallest group proportion, we show that optimizing the worst-case risk over an appropriate chi-square divergence ball bounds the worst-case risk over groups. Our approach is computationally efficient, and can be applied as a small modification to a wide class machine learning models trained by stochastic gradient descent methods. We show that DRO succeeds on the examples where ERM becomes unfair, and demonstrate higher average minority user satisfaction and lower disparity amplification on a Amazon Mechanical Turk based autocomplete task."}, {"heading": "1.1. Fairness in Machine Learning", "text": "Recently, there has been a surge of interest in fairness in machine learning (Barocas & Selbst, 2016). Our work can be seen as a direct instantiation of John Rawls\u2019 theory on distributive justice and stability, where we view predictive accuracy as a resource to be allocated. Rawls argues that the difference principle, defined as maximizing the welfare of the worst-off group, is fair and stable over time since it ensures that minorities consent to and attempt to maintain the status quo (Rawls, 2001, p155).\nIn this work, we assume the task is general loss minimization, and demographic data is unavailable. This differs from the substantial body of existing research into fairness for classification problems involving protected labels such as the use of race in recidivism protection (Chouldechova, 2017). There has been extensive work (Barocas & Selbst, 2016) on guaranteeing fairness for classification over a protected label through constraints such as equalized odds (Woodworth et al., 2017; Hardt et al., 2016), disparate impact (Feldman et al., 2015) and calibration (Kleinberg et al., 2017). However, these approaches require the use of demographic labels, and are designed for classification tasks. This makes it difficult to apply such approaches to mitigate representation disparity in tasks such as speech recognition or natural language generation where full demographic information is often unavailable.\nA number of authors have also studied individual notions of fairness, either through a fixed similarity function (Dwork et al., 2012) or subgroups of a set of protected labels (Kearns et al., 2018; He\u0301bert-Johnson et al., 2017). Dwork et al. (2012) provides fairness guarantees without explicit groups, but requires a fixed distance function which is difficult to define for real-world tasks. Kearns et al. (2018); He\u0301bertJohnson et al. (2017) consider subgroups of a set of protected features, but defining non-trivial protected features which cover the latent demographics in our setting is difficult. Although these works generalize the demographic group structure, similarity and subgroup structure are both ill-defined for many real-world tasks.\nIn the online setting, works on fairness in bandit learning (Joseph et al., 2016; Jabbari et al., 2017) propose algorithms compatible with Rawls\u2019 principle on equality of opportunity\u2014an action is preferred over another only if the true quality of the action is better. Our work differs in considering Rawlsian fairness for distributive justice (Rawls, 2009). Simultaneous with our work, Liu et al. (2018) analyzed fairness over time in the context of constraint based fairness criteria, and show that enforcing static fairness constraints do not ensure fairness over time. In this paper, we consider latent demographic groups and study a loss-based approach to fairness and stability."}, {"heading": "2. Problem setup", "text": "We begin by outlining the two parts of our motivation: representation disparity and disparity amplification.\nRepresentation disparity: Consider the standard lossminimization setting where a user makes a query Z \u223c P , a model \u03b8 \u2208 \u0398 makes a prediction, and the user incurs loss `(\u03b8;Z). We denote the expected loss as the risk R(\u03b8) = EZ\u223cP [`(\u03b8;Z)]. The observations Z are assumed to arise from one of K latent groups such that Z \u223c P := \u2211 k\u2208[K] \u03b1kPk. We assume that neither the population proportions {\u03b1k} nor the group distributions {Pk} are known. The goal is to control the worst-case risk over all K groups:\nRmax(\u03b8) = max k\u2208[K] Rk(\u03b8), Rk(\u03b8) := EPk [`(\u03b8;Z)]. (1)\nRepresentation disparity refers to the phenomenon of low R(\u03b8) and highRmax(\u03b8) due to a group with small \u03b1k.\nDisparity amplification: To understand the amplification of representation disparity over time, we will make several assumptions on the behavior of users in response to observed losses. These assumptions are primarily for clarity of exposition\u2014we will indicate whenever the assumptions can be relaxed leave generalizations to the supplement. Roughly speaking, minimizing the worst-case risk Rmax(\u03b8) should mitigate disparity amplification as long as lower losses lead to higher user retention. We now give assumptions that make this intuition precise.\nIn the sequential setting, loss minimization proceeds over t = 1, 2, . . . T rounds, where the group proportion \u03b1(t)k depends on t and varies according to past losses. At each round \u03bb(t+1)k is the expected number of users from group k, which is determined by \u03bd(Rk(\u03b8)), the fraction of users retained, and bk, the number of new users (see Definition 1). Here, \u03bd is a differentiable, strictly decreasing retention function which maps a risk levelR to the fraction of users who continue to use the system. Modeling user retention as a decreasing function of the risk implies that each user makes an independent decision of whether to interact with the system at time t+ 1 based on their expected loss at time t. For example, selecting \u03bd(x) = 1\u2212 x andRk equal to the expected zero-one loss implies that users leave proportional to the misclassification rates of their queries.\nAt each round we learn parameters \u03b8(t+1) based on n(t+1) \u223c Pois( \u2211 k \u03bb (t+1) k ) users (data points). While we define the sample size as a Poisson process for concreteness, our main results hold for any distribution fulfilling the strong law of large numbers, as we perform all stability analyses in the population limit.\nDefinition 1 (Dynamics). Given a sequence \u03b8(t), for each t = 1 . . . T , the expected number of users \u03bb and samples\nZ (t) i starting at \u03bb (0) k = bk is governed by:\n\u03bb (t+1) k := \u03bb (t) k \u03bd(Rk(\u03b8 (t))) + bk\n\u03b1 (t+1) k := \u03bb (t+1) k\u2211\nk\u2032\u2208[K] \u03bb (t+1) k\u2032\nn(t+1) := Pois( \u2211 k \u03bb (t+1) k )\nZ (t+1) 1 . . . Z (t+1) n(t+1) i.i.d.\u223c P (t+1) := \u2211 k\u2208[K] \u03b1 (t+1) k Pk.\nIf we use ERM at each time step the parameter sequence is defined as \u03b8(t) = arg min\u03b8\u2208\u0398 \u2211 i `(\u03b8;Z (t) i ).\nOur goal is to control over all groups k = 1, . . . ,K and time periods t = 1, . . . , T the group-wise riskRk(\u03b8(t)),\nRTmax(\u03b8(0), \u00b7 \u00b7 \u00b7 , \u03b8(T )) = max k,t\n{ Rk(\u03b8(t)) } . (2)\nWithout knowledge of group membership labels, population proportions \u03b1(t)k , new user rate bk, and retention rate \u03bd, minimizingRTmax gives rise to two major challenges. First, without group membership labels there is no way to directly measure the worst-case risk RTmax, let alone minimize it. Second, we must ensure that the group proportions \u03b1(t)k are stable, since if \u03b1(t)k \u2192 0 as t\u2192\u221e for some group k \u2208 [K], then no algorithm can controlRTmax when a group has near zero probability of appearing in our samples.\nWe begin by illustrating how models that are initially fair with low representation disparity may become unfair over time if we use ERM (Section 3). We then propose a solution based on distributionally robust optimization (Section 4), and study examples where this approach mitigates representation disparity in our experimental section (Section 5)."}, {"heading": "3. Disparity amplification", "text": "The standard approach to fitting a sequence of models \u03b8(t) is to minimize an empirical approximation to the population risk at each time period. In this section, we show that even minimizing the population risk fails to control minority risk over time, since expected loss (average case) leads to disparity amplification. The decrease in user retention for the minority group is exacerbated over time since once a group shrinks sufficiently, it receives higher losses relative to others, leading to even fewer samples from the group."}, {"heading": "3.1. Motivating example", "text": "Consider the two-class classification problem in Figure 1 where the two groups are drawn from Gaussians and the\noptimal classification boundary is given along x2 = 0. Assume that the sampling distribution evolves according to definition 1 with \u03bd(x) = 1.0\u2212x, ` equal to the zero one loss, and b0 = b1 = n (0) 0 = n (0) 1 = 1000. Initially, ERM has similar and high accuracy on both groups with the boundary x2 > 0, but over time random fluctuations in accuracy result in slightly fewer samples from the cluster on the right. This leads to disparity amplification since ERM will further improve the loss on the left cluster at the expense of the right cluster. After 500 rounds, there are nearly no samples from the right cluster, and as a result, the right cluster ends up suffering high loss."}, {"heading": "3.2. Conditions for disparity amplification", "text": "The example above demonstrated that disparity amplification can occur easily even in a situation where the two groups have identical population size and initial risk. In general if we view the expected user counts \u03bb(t) as a dynamical system, the long-term fairness properties for any fairness criteria are controlled by two factors - whether \u03bb has a fair fixed point (defined as a population fraction where risk minimization maintains the same population fraction over time) and whether this fixed point is stable.\nFixed points of risk minimization are determined by a combination of user retention function \u03bd and the models \u03b8(t), and without knowledge of \u03bd it is hard to ensure that a model has a fair fixed point. Even if a fixed point is fair, such as when the population fraction and risk received by each group is equal, and we start at this fair fixed point, minimizing the empirical loss may deviate from this fair fixed point over time due to finite sample fluctuations or noise in the model estimation procedure.\nTo show this result, we study the dynamical system \u03a6, which is defined by dynamics in Definition 1 with \u03b8 derived from minimizing the population, rather than empirical risk.\nDefinition 2. Let \u03a6 be the update for the expected population size\n\u03bb (t+1) k := \u03a6(\u03bb (t) k ) = \u03bb (t) k \u03bd(Rk(\u03b8(\u03bb (t) k ))) + bk,\n\u03b8(\u03bb (t) k ) = arg min \u03b8 E\u2211 k \u03b1 (t) k Pk [`(\u03b8;Z)].\nThe arrival intensity \u03bb\u2217 is called a fixed point if \u03bb\u2217 = \u03a6(\u03bb\u2217).\nThis fixed point is stable whenever the maximum modulus of the eigenvalues of the Jacobian of \u03a6 is less than one and unstable whenever it is greater than one (Luo, 2012, Theorem 2.1).\nProposition 1 gives a precise statement of this phenomenon. We prove the result in Section A.1, and further show a generalization to general dynamics \u03a6(\u03bbk) = h(\u03bbk,Rk) where h is differentiable and monotone in the second argument. We denote by \u03c1max(A) the maximum modulus of the eigenvalues of A.\nProposition 1. Let \u03bb\u2217 = \u03a6(\u03bb\u2217) be a fixed point, and \u03b8\u2217 = arg min\u03b8 E\u2211\nk \u03b1 \u2217 kPk\n[`(\u03b8;Z)] be the minimizer at \u03bb\u2217.\nDefine HR(\u03b1\u2217) as the positive definite Hessian of the expected risk at \u03b8\u2217, \u03bb\u2217 and define\u2207L as the per-group parameter gradients at \u03b8\u2217,\n\u2207L = \u2207\u03b8EP1 [`(\u03b8 \u2217;Z)]\n... \u2207\u03b8EPk [`(\u03b8\u2217;Z)]  . The arrival intensity \u03bb\u2217 is unstable whenever\n\u03c1max\n( diag(\u03bd(R(\u03b8(\u03bb\u2217))))\u2212 diag(\u03bb\u2217\u03bd\u2032(R(\u03b8(\u03bb\u2217))\n\u2207LHR(\u03b1\u2217)\u22121\u2207L> (\nI\u2211 k \u03bb \u2217 k \u2212 1\u03bb \u2217> ( \u2211 k \u03bb \u2217 k) 2\n)) > 1.\nWe see that the major quantities which control risk are the retention rate \u03bd and its derivative, as well as a K \u00d7 K square matrix \u2207LHR(\u03b1\u2217)\u22121\u2207L> which roughly encodes the changes in one group\u2019s risk as a function of another.\nWe can specialize the stability condition to obtain an intuitive and negative result for the stability of risk minimization (average case). Even if we start at a fair fixed point with \u03bb\u22171 = \u00b7 \u00b7 \u00b7 = \u03bb\u2217k and R1 = \u00b7 \u00b7 \u00b7 = Rk, if decreasing the risk for one group increases the risk for others sufficiently, the fixed point is unstable and the model will eventually converge to a different, possibly unfair, fixed point.\nCorollary 1 (Counterexample under symmetry). Let \u03bb\u22171 = \u00b7 \u00b7 \u00b7 = \u03bb\u2217k be a fixed point with R1 = \u00b7 \u00b7 \u00b7 = Rk, then for any strongly convex loss,\n\u03c1max ( \u2207LHR(\u03b1\u2217)\u22121\u2207L> ) >\n1\u2212 \u03bd(R1) \u2212\u03bd\u2032(R1)/k . (3)\nis a sufficient condition for instability.\nSee Section A.2 for proof and generalizations.\nThe bound (3) has a straightforward interpretation. The left hand side is the stability of the model, where maximal eigenvalue of the matrix\u2207LHR(\u03b1\u2217)\u22121\u2207L> represents the maximum excess risk that can be incurred due to a small\nperturbation in the mixture weights \u03b1. The right hand side represents the underlying stability of the dynamics and measures the sensitivity of \u03bb with respect to risk.\nMean and median estimation: Consider a simple mean estimation example where each user belongs to one of two groups, \u22121 or 1 and incurs loss (\u03b8 \u2212 Z)2. \u03b8 = 0 is clearly a fair fixed point, since it equalizes losses to both groups, with Hrisk(\u03b1\u2217) = 1/2 and \u2207L = [2,\u22122] mak-\ning \u03c1max ( \u2207LHR(\u03b1\u2217)\u22121\u2207L> ) = 4. If we select \u03bd(x) =\nexp(\u2212x), the right hand side becomes 2(1\u2212 e\u22121)e \u2248 3.4, and thus any perturbation will eventually result in \u03bb1 6= \u03bb2. In this case the only other fixed points are the unfair solutions of returning the mean of either one of the groups.\nThe situation is even worse for models which are not strongly convex, such as median estimation. Replacing the squared loss above with the absolute value results in a loss which has a non-unique minimizer at 0 when \u03bb1 = \u03bb2 but immediately becomes \u22121 whenever \u03bb1 > \u03bb2. In this case, no conditions on the retention function \u03bd can induce stability. This fundamental degeneracy motivates us to search for loss minimization schemes with better stability properties than ERM (average case)."}, {"heading": "4. Distributionally robust optimization (DRO)", "text": "Recall that our goal is to control the worst-case risk (2) over all groups and over all time steps t. We will proceed in two steps. First, we show that performing distributionally robust optimization controls the worst-case riskRmax(\u03b8(t)) for a single time step. Then, we show that this results in a lower bound on group proportions {\u03b1(t)k }Kk=1, and thus ensures control over the worst-case risk for all time steps. As a result of the two steps, we show in Section 4.4 that our procedure mitigates disparity amplification over all time steps. For notational clarity, we omit the superscript t in Sections 4.1-4.3."}, {"heading": "4.1. Bounding the risk over unknown groups", "text": "The fundamental difficulty in controlling the worst-case group risk over a single time-step Rmax(\u03b8(t)) comes from not observing the group memberships from which the data was sampled. For many machine learning systems such as speech recognition or machine translation, such situations are common since we either do not ask for sensitive demographic information, or it is unclear a priori which demographics should be protected. To achieve reasonable performance across different groups, we postulate a formulation that protects against all directions around the data generating distribution. We build on the distributionally robust formulation of Duchi et al. (2016) which will allow us to control the worst-case group riskRmax(\u03b8(t)).\nTo formally describe our approach, let D\u03c72 (P ||Q) be the \u03c72-divergence between probability distributions P and\nQ given by D\u03c72 (P ||Q) := \u222b ( dP dQ \u2212 1 )2 dQ. If P is not absolutely continuous with respect to Q, we define D\u03c72 (P ||Q) :=\u221e.\nLet B(P, r) be the chi-squared ball around a probability distribution P of radius r so that B(P, r) := {Q P : D\u03c72 (Q||P ) \u2264 r}. We consider the worst-case loss over all r-perturbations around P ,\nRdro(\u03b8; r) := sup Q\u2208B(P,r) EQ[`(\u03b8;Z)]. (4)\nIntuitively, the distributionally robust risk Rdro(\u03b8; r) upweights examples Z with high loss `(\u03b8;Z). If there is a group suffering high loss, the corresponding mixture component will be over-represented (relative to the original mixture weights) in the distributionally robust risk Rdro(\u03b8; r). We show in the following proposition that Rdro(\u03b8; r) bounds the risk of each group Rk(\u03b8), and hence the group-wise worst-case risk (1), for an appropriate choice of the robustness radius r.\nProposition 2. For P := \u2211 k\u2208[K] \u03b1kPk, we haveRk(\u03b8) \u2264 Rdro(\u03b8; rk) for all \u03b8 \u2208 \u0398 where rk := (1/\u03b1k \u2212 1)2 is the robustness radius.\nWe prove the result in Section A.4. Roughly speaking, the above bound becomes tighter if the variation in the loss `(\u03b8;Z) is substantially higher between groups than within each group. In particular, this would be the case if the loss distribution for each group have distinct support with relatively well-concentrated components within each group.\nAs a consequence of Proposition 2, if we have a lower bound on the group proportions \u03b1min \u2264 mink\u2208[K] \u03b1k, then we can control the worst-case group risk Rmax(\u03b8) by minimizing the upper bound \u03b8 7\u2192 Rdro(\u03b8; rmax) where rmax := (1/\u03b1min \u2212 1)2.\nSimilar formulations for robustness around the empirical distribution with radius shrinking as r/n had been considered in (Ben-Tal et al., 2013; Lam & Zhou, 2015; Duchi & Namkoong, 2016). While there are many possible robustness balls B which could provide upper bounds on group risk, we opt to use the chi-squared ball since it is straightforward to optimize (Ben-Tal et al., 2013; Namkoong & Duchi, 2016; 2017) and we found it empirically outperformed other f -divergence balls."}, {"heading": "4.2. Interpreting the dual", "text": "The dual of the maximization problem (4) provides additional intuition on the behavior of the robust risk.\nProposition 3 ((Duchi & Namkoong, 2018)). If `(\u03b8; \u00b7) is upper semi-continuous for any \u03b8, then for rmax \u2265 0 and\nany \u03b8,Rdro(\u03b8; rmax) is equal to the following expression\ninf \u03b7\u2208R\n{ F (\u03b8; \u03b7) := C ( EP [ [`(\u03b8, Z)\u2212 \u03b7]2+ ]) 1 2 + \u03b7 } (5)\nwhere C = ( 2(1/\u03b1min \u2212 1)2 + 1 )1/2 .\nDenoting by \u03b7? the optimal dual variable (5), we see from the proposition that all examples suffering less than \u03b7?levels of loss are completely ignored, and large losses above \u03b7? are upweighted due to the squared term.\nHowever, unlike standard parameter regularization techniques, which encourage \u03b8 to be close to some point, our objective biases the model to have fewer high loss examples which matches our goal of mitigating representation disparity.\nMedian Estimation: Recall the median estimation problem over two groups mentioned in Section 3.2 where the loss is `(\u03b8;Z) = \u2016\u03b8 \u2212 Z\u20161. Figure 2 shows the behavior of both ERM and DRO on this median estimation task with unbalanced (\u03b1min = 0.1) groups. The parameter estimate which minimizes Rmax for this problem is \u03b8fair = 0 since this is equidistant from both groups. ERM on the other hand focuses entirely on the majority and returns \u03b8ERM \u2248 \u22121.0.\nDRO returns \u03b8\u2217DRO which is close to \u03b8fair. Analyzing the risk, we find that the single-step worst-case group riskRmax(\u03b8) in (1) is an upper bound on ERM, and DRO forms a tight upper bound this quantity (Figure 2b). We can also understand the behavior of DRO through the worst-case distribution Q in Equation 4. Figure 2a shows the worst-case distribution Q at the minimizer \u03b8\u2217DRO which completely removes points within distance \u03b7\u2217. Additionally, points far from \u03b8\u2217DRO are upweighted, resulting in a large contribution to the loss from the minority group.\nWe expect the bound to be tight when all individuals within a group receive the same loss. In this case, thresholding\nby \u03b7\u2217 corresponds to selecting the single highest risk group which is equivalent to directly minimizingRmax(\u03b8) (1).\nOn the other hand, the worst case for our approach is if \u03b1min is small, and a group with low expected loss has a high loss tail with population size \u03b1min. In this case DRO is a loose upper bound and optimizes the losses of the group with already low expected loss.\nThis is closely related to recent observations that the DRO bound can be loose for classification losses such as the zeroone loss due to the worst-case distribution consisting purely of misclassified examples (Hu et al., 2018). Even in this case, the estimated loss is still a valid upper bound on the worst case group risk, and as Figure 2 shows, there are examples where the DRO estimate is nearly tight."}, {"heading": "4.3. Optimization", "text": "We now show how to minimize \u03b8 7\u2192 Rdro(\u03b8; rmax) efficiently for a large class of problems. For models such as deep neural networks that rely on stochastic gradient descent, the dual objective F (\u03b8; \u03b7) in (5) can be used directly since it only involves an expectation over the data generating distribution P .\nFormally, the following procedure optimizes (4): for a given value of \u03b7, compute the approximate minimizer \u03b8\u0302\u03b7\nminimize \u03b8\u2208\u0398\nEP [`(\u03b8;Z)\u2212 \u03b7]2+ . (6)\nFrom Propositions 2 and 3, we have\nRmax(\u03b8\u0302\u03b7) \u2264 Rdro(\u03b8\u0302\u03b7; rmax) \u2264 F (\u03b8\u0302\u03b7, \u03b7)\nwhich implies that we can treat \u03b7 as a hyperparameter. For convex losses \u03b8 7\u2192 `(\u03b8;Z), the function \u03b7 7\u2192 F (\u03b8\u0302\u03b7, \u03b7) is convex, and thus we can perform a binary search over \u03b7 to find the global optimum efficiently.\nAlternatively, for models where we can compute \u03b8\u2217(Q) \u2208 argmin\u03b8\u2208\u0398 EQ[`(\u03b8;Z)] efficiently, we can use existing primal solvers that compute the worst-case probability distribution Q\u2217(\u03b8) \u2208 argmaxQ\u2208B(P,r) EQ[`(\u03b8;Z)] for a given \u03b8 based on projected gradient ascent on Q (Namkoong & Duchi, 2016). By alternating between optimization on \u03b8 and Q, we can efficiently find the saddle point (\u03b8\u2217, Q\u2217) that satisfies \u03b8\u2217 = \u03b8\u2217(Q\u2217) and Q\u2217 = Q\u2217(\u03b8\u2217)."}, {"heading": "4.4. Stability of minority loss minimization", "text": "We have thus far demonstrated that for a single time step, the worst-case risk over all groups Rmax(\u03b8) = maxkRk(\u03b8) can be controlled by the distributionally robust riskRdro(\u03b8; rmax) where rmax := (1/\u03b1min \u2212 1)2 and \u03b1min is the minority group proportion. Now, we study how the individual group risk Rk(\u03b8) affects user retention and\nhence future risk. By virtue of providing an upper bound toRmax(\u03b8), optimizingRdro(\u03b8; rmax) at each time step can thus control the future group riskRmax(\u03b8).\nWe show that if the initial group proportions satisfy \u03b1(0)k \u2265 \u03b1min and the worst-case riskRmax(\u03b8(t)) is sufficiently small at each time t, then we can ensure \u03b1(t+1)k > \u03b1min. Thus, to controlRTmax, the worst-case group risk over all time steps, it suffices to control Rdro(\u03b8(t); rmax) using the procedure in Section 4.3.\nProposition 4. Assume the retention model in Definition 1. Let \u03b1(t)k > \u03b1min, bk\u2211 k bk > \u03b1min, \u03bb(t) := \u2211 k \u03bb (t) k \u2264 \u2211 k bk 1\u2212\u03bdmax , and \u03bd(Rk(\u03b8(t))) < \u03bdmax. Then, whenever we have\nRk(\u03b8(t)) \u2264 \u03bd\u22121 (\n1\u2212 (1\u2212 \u03bdmax)bk \u03b1min \u2211 k bk\n) ,\n\u03b1 (t+1) k = \u03bb(t)\u03b1 (t) k \u03bd(Rk(\u03b8(t))) + bk\u2211\nl \u03bb (t)\u03b1 (t) l \u03bd(Rl(\u03b8(t))) + bl\n> \u03b1min.\nWe conclude that as long as we can guarantee\nRdro(\u03b8(t); rmax) \u2264 \u03bd\u22121 (\n1\u2212 (1\u2212 \u03bdmax)bk \u03b1min \u2211 k bk\n) , (7)\nwe can control RTmax(\u03b8(0), . . . , \u03b8(T )), the unknown worstcase group risk over all time steps by optimizing Rdro(\u03b8(t); rmax) at each step t. While the condition (7) is hard to verify in practice, we observe empirically in Section 5 that optimizing the distributionally robust risk Rdro(\u03b8(t); rmax) at time step t indeed significantly reduces disparity amplification in comparison to using ERM.\nProposition 4 gives stronger fairness guarantees than the stability conditions for ERM in Proposition 1. In ERM the best one can do is to add strong convexity to the model to stabilize to a possibly unfair fixed point. In contrast, Proposition 4 gives conditions for controlling Rmax over time without assuming that there exists a fair fixed point.\nStability of median estimation: Returning to our running example of geometric median estimation, we can show that under the same dynamics, ERM is highly unstable while DRO is stable. Consider a three Gaussian mixture on the corners of the simplex, with L2 loss, retention function \u03bd(r) = exp(\u2212r), and b1 = b2 = 50, n(t) = 1000. By construction, (1/3, 1/3, 1/3) is the fair parameter estimate.\nFigure 3 shows that ERM is highly unstable, with the only stable fixed points being the corners, where a single group dominates all others. The fair parameter estimate is an unstable fixed point for ERM, and any perturbation eventually results in a completely unfair parameter estimate. On the other hand, DRO has the reverse behavior, with the fair parameter estimate being the unique stable fixed point."}, {"heading": "5. Experiments", "text": "We demonstrate the effectiveness of DRO on our motivating example (Figure 1) and human evaluation of a text autocomplete system on Amazon Mechanical Turk. In both cases, DRO controls the worst-case riskRTmax over time steps and improves minority retention."}, {"heading": "5.1. Simulated task", "text": "Recall the motivating example in Figure 1 which shows that logistic regression applied to a two-class classification problem is unstable and becomes pathologically unfair.\nThe data is constructed by drawing from a mixture of two Gaussians (groups) centered at (\u22121.5, 0) and (0, 1.5). The two groups are labeled according to the linear decision boundaries (\u22123/2, \u221a 32 \u2212 1/3) and (3/2, \u221a 32 \u2212 1/3) respectively such that classifying with x2 > 0 is accurate, but the optimal linear classifier on one group achieves 50% accuracy on the other.\nAt each round we fit a logistic regression classifier using ERM or DRO and gradient descent, constraining the norm of the weight vector to 1. Our dynamics follow Definition 1 with \u03bd(x) = 1\u2212 x,R as the zero-one loss, and bk = 1000. The DRO model is trained using the dual objective with logistic loss, and \u03b7 = 0.95, which was the optimal dual solution to \u03b1min = 0.2. The results do not qualitatively change for choices of \u03b1min < 0.5, and we show that we obtain control even for group sizes substantially smaller than 0.2 (Figure 6).\nFigure 5 shows that ERM is unstable and the minority group rapidly loses accuracy beyond 300 rounds on most runs. In contrast, DRO is stable, and maintains an accuracy of 0.8.\nThis stability is due to the fact that the regularized loss for DRO prevents small losses in the minority fraction from amplifying, as we discuss in Proposition 4. Even when the minority fraction falls as low as 1%, the DRO loss ensures that the accuracy of this minority fraction remains at 75% accuracy (Figure 6)."}, {"heading": "5.2. Autocomplete task", "text": "We now present a real-world, human evaluation of user retention and satisfaction on a text autocomplete task. The task consists of the prediction of next words in a corpus of tweets built from two estimated demographic groups, African Americans and White Americans (Blodgett et al., 2016). There are several distinguishing linguistic patterns between tweets from these groups, whose language dialects we henceforth refer to as African-American English (AAE) and Standard-American English (SAE), respectively, following the nomenclature in Blodgett et al. (2016). Our overall experimental design is to measure the retention rate \u03bd and riskR for various choices of demographic proportions (\u03b1AAE, \u03b1SAE) and simulate the implied dynamics, since running a fully online experiment would be prohibitively expensive.\nFor both ERM and DRO, we train a set of five maximum likelihood bigram language models on a corpus with 366,361 tweets total and a f \u2208 {0.1, 0.4, 0.5, 0.6, 0.9} fraction of the tweets labeled as AAE. This results in 10 possible autocomplete systems a given Mechanical Turk user can be assigned to during a task.\nTo evaluate the retention and loss for AAE and SAE separately, a turk user is assigned 10 tweets from either the held out AAE tweets or SAE tweets, which they must replicate using a web-based keyboard augmented by the autocomplete system. This assignment of a turk user to a demographic group simulates the situation where a user from a particular demographic group attempts to use the autocomplete system to write a tweet. Details of the autocomplete task are included in the supplement.\nAfter completing the task, users were asked to fill out a survey which included a rank from 1 to 5 on their satisfaction with the task, and a yes/no question asking whether they would continue to use such a system. We assign 50 users to each of the two held out set types and each of the 10 autocomplete models, resulting in 1,000 users\u2019 feedback across autocomplete models and assigned demographics.\nThe response to whether a user would continue to use the autocomplete system provides samples \u03bd(RK(\u03b1)) with n = 366361 and each of possible demographic proportions \u03b1. The user satisfaction survey provides a surrogate forRK(\u03b1) at these same points. We interpolate \u03bd andRK to \u03b1 \u2208 [0, 1] via isotone regression which then allows us to simulate the user dynamics and satisfaction over time using Definition 1. We estimate variability in these estimates via bootstrap replicates on the survey responses.\nOur results in Figure 4 show an improvement in both minority satisfaction and retention rate due to DRO: we improve the median user satisfaction from 3.7 to 4.0 and retention from 0.7 to 0.85, while only slightly decreasing the SAE\nsatisfaction and retention. Implied user counts follow the same trend with larger differences between groups due to compounding.\nCounterintuitively, the minority group has higher satisfaction and retention under DRO. Analysis of long-form comments from Turkers suggest this is likely due to users valuing the model\u2019s ability to complete slang more highly than completion of common words and indicates a slight mismatch between our training loss and human satisfaction with an autocomplete system."}, {"heading": "6. Discussion", "text": "In this work we argued for a view of loss minimization as a distributive justice problem and showed that ERM often results in disparity amplification and unfairness. We demonstrate that DRO provides a upper bound on the risk incurred by minority groups and performs well in practice.\nOur proposed algorithm is straightforward to implement, and induces distributional robustness, which can be viewed as a benefit in and of itself.\nOur arguments against ERM and in favor of minority risk minimization mirror Rawls\u2019 arguments against utilitarianism, and thus inherit the critiques of Rawlsian distributive justice. Examples of such critiques are the focus on an abstract worst-off group rather than demographic groups or individuals (Altham, 1973), extreme risk-aversion (Mueller et al., 1974), and utilitarianism with diminishing returns as an alternative (Harsanyi, 1975). In this work, we do not address the debate on the correctness of Rawlsian justice (Rawls, 2001), and leave finding a suitable philosophical framework for loss minimization to future work.\nThere are two large open questions from our work. First, as fairness is fundamentally a causal question, observational approaches such as DRO can only hope to control limited aspects of fairness. The generality with which our algorithm can be applied also limits its ability to enforce fairness as a constraint, and thus our approach here is unsuitable for high-stakes fairness applications such as classifiers for loans, criminality, or admissions. In such problems the implied minorities from DRO may differ from well-specified demographic groups who are known to suffer from historical and societal biases. This gap arises due to looseness in the DRO bound (Hu et al., 2018), and could be mitigated using smoothness assumptions (Dwork et al., 2012).\nSecond, distributional robustness proposed here runs counter to classical robust estimation for rejecting outlier samples, as high loss groups created by an adversary can easily resemble a minority group. Adversarial or high-noise settings loosen the DRO upper bound substantially, and it is an open question whether it is possible to design algorithms which are both fair to unknown latent groups and robust.\nReproducibility: Code to generate results available on the CodaLab platform at https://bit.ly/2sFkDpE.\nAcknowledgements: This work was funded by an Open Philanthropy Project Award."}], "year": 2018, "references": [{"title": "Deep speech 2 end to end speech recognition in English and mandarin", "authors": ["D Amodei"], "venue": "In International Conference on Machine Learning (ICML),", "year": 2016}, {"title": "Big data\u2019s disparate impact", "authors": ["S. Barocas", "A.D. Selbst"], "venue": "California Law Review,", "year": 2016}, {"title": "Robust solutions of optimization problems affected by uncertain probabilities", "authors": ["A. Ben-Tal", "D. den Hertog", "A.D. Waegenaere", "B. Melenberg", "G. Rennen"], "venue": "Management Science,", "year": 2013}, {"title": "Demographic dialectal variation in social media: A case study of African-American English", "authors": ["S.L. Blodgett", "L. Green", "B. O\u2019Connor"], "venue": "In Empirical Methods in Natural Language Processing (EMNLP),", "year": 2016}, {"title": "A study of bias in recidivism prediciton instruments", "authors": ["A. Chouldechova"], "venue": "Big Data,", "year": 2017}, {"title": "Variance-based regularization with convex objectives", "authors": ["J.C. Duchi", "H. Namkoong"], "venue": "[stat.ML],", "year": 2016}, {"title": "Distributionally robust stochastic optimization: Minimax rates and asymptotics", "authors": ["J.C. Duchi", "H. Namkoong"], "venue": "Working Paper,", "year": 2018}, {"title": "Statistics of robust optimization: A generalized empirical likelihood approach", "authors": ["J.C. Duchi", "P.W. Glynn", "H. Namkoong"], "venue": "[stat.ML],", "year": 2016}, {"title": "Fairness through awareness", "authors": ["C. Dwork", "M. Hardt", "T. Pitassi", "O. Reingold", "R. Zemel"], "venue": "In Innovations in Theoretical Computer Science (ITCS),", "year": 2012}, {"title": "Certifying and removing disparate impact", "authors": ["M. Feldman", "S. Friedler", "J. Moeller", "C. Scheidegger", "S. Venkatasubramanian"], "venue": "In International Conference on Knowledge Discovery and Data Mining (KDD), pp", "year": 2015}, {"title": "Predictably unequal? the effects of machine learning on credit markets", "authors": ["A. Fuster", "P. Goldsmith-Pinkham", "T. Ramadorai", "A. Walther"], "venue": "Technical report, CEPR Discussion Papers,", "year": 2017}, {"title": "Report on the evaluation of 2d still-image face recognition algorithms", "authors": ["P.J. Grother", "G.W. Quinn", "P.J. Phillips"], "venue": "Technical report,", "year": 2011}, {"title": "Equality of opportunity in supervised learning", "authors": ["M. Hardt", "E. Price", "N. Srebo"], "venue": "In Advances in Neural Information Processing Systems (NIPS),", "year": 2016}, {"title": "Can the maximin principle serve as a basis for morality? a critique of john rawls\u2019s theory", "authors": ["J.C. Harsanyi"], "venue": "The American Political Science Review,", "year": 1975}, {"title": "Calibration for the (computationallyidentifiable) masses", "authors": ["\u00da. H\u00e9bert-Johnson", "M.P. Kim", "O. Reingold", "G.N. Rothblum"], "venue": "arXiv preprint arXiv:1711.08513,", "year": 2017}, {"title": "Tagging performance correlates with age", "authors": ["D. Hovy", "A. Sgaard"], "venue": "In Association for Computational Linguistics (ACL), pp", "year": 2015}, {"title": "Does distributionally robust supervised learning give robust classifiers", "authors": ["W. Hu", "G. Niu", "I. Sato", "M. Sugiyama"], "venue": "In International Conference on Machine Learning (ICML),", "year": 2018}, {"title": "Fairness in reinforcement learning", "authors": ["S. Jabbari", "M. Joseph", "M. Kearns", "J. Morgenstern", "A. Roth"], "venue": "In International Conference on Machine Learning (ICML),", "year": 2017}, {"title": "Rawlsian fairness for machine learning", "authors": ["M. Joseph", "M. Kearns", "J. Morgenstern", "S. Neel", "A. Roth"], "venue": "In FATML,", "year": 2016}, {"title": "Incorporating dialectal variability for socially equitable language identification", "authors": ["D. Jurgens", "Y. Tsvetkov", "D. Jurafsky"], "venue": "In Association for Computational Linguistics (ACL),", "year": 2017}, {"title": "Preventing fairness gerrymandering: Auditing and learning for subgroup fairness", "authors": ["M. Kearns", "S. Neel", "A. Roth", "Z.S. Wu"], "venue": "arXiv preprint arXiv:1711.05144,", "year": 2018}, {"title": "Inherent trade-offs in the fair determination of risk scores", "authors": ["J. Kleinberg", "S. Mullainathan", "M. Raghavan"], "venue": "In Innovations in Theoretical Computer Science (ITCS),", "year": 2017}, {"title": "Quantifying input uncertainty in stochastic optimization", "authors": ["H. Lam", "E. Zhou"], "venue": "In Proceedings of the 2015 Winter Simulation Conference", "year": 2015}, {"title": "Delayed impact of fair machine learning", "authors": ["L.T. Liu", "S. Dean", "E. Rolf", "M. Simchowitz", "M. Hardt"], "venue": "arXiv preprint arXiv:1803.04383,", "year": 2018}, {"title": "Regularity and complexity in dynamical systems", "authors": ["A.C. Luo"], "year": 2012}, {"title": "The utilitarian contract: A generalization of rawls\u2019 theory of justice", "authors": ["D.C. Mueller", "R.D. Tollison", "T.D. Willet"], "venue": "Theory and Decision,", "year": 1974}, {"title": "Stochastic gradient methods for distributionally robust optimization with f divergences", "authors": ["H. Namkoong", "J.C. Duchi"], "venue": "In Advances in Neural Information Processing Systems", "year": 2016}, {"title": "Variance regularization with convex objectives", "authors": ["H. Namkoong", "J.C. Duchi"], "venue": "In Advances in Neural Information Processing Systems", "year": 2017}, {"title": "Justice as fairness: a restatement", "authors": ["J. Rawls"], "year": 2001}, {"title": "A theory of justice: Revised edition", "authors": ["J. Rawls"], "year": 2009}, {"title": "Academic performance prediction in a gender-imbalanced environment", "authors": ["P. Sapiezynski", "V. Kassarnig", "C. Wilson", "S. Lehmann", "A. Mislove"], "venue": "In FATREC,", "year": 2017}, {"title": "Gender and dialect bias in youtubes automatic captions", "authors": ["R. Tatman"], "venue": "In Workshop on Ethics in Natural Langauge Processing,", "year": 2017}, {"title": "Learning non-discriminatory predictors", "authors": ["B. Woodworth", "S. Gunasekar", "M.I. Ohannessian", "N. Srebro"], "venue": "In Conference on Learning Theory (COLT),", "year": 2017}], "id": "SP:16f0c508aa54e26aa18e3b0f3c91b0c143c6a605", "authors": [{"name": "Tatsunori B. Hashimoto", "affiliations": []}, {"name": "Megha Srivastava", "affiliations": []}, {"name": "Hongseok Namkoong", "affiliations": []}, {"name": "Percy Liang", "affiliations": []}, {"name": "Tatsunori Hashimoto", "affiliations": []}], "abstractText": "Machine learning models (e.g., speech recognizers) are usually trained to minimize average loss, which results in representation disparity\u2014 minority groups (e.g., non-native speakers) contribute less to the training objective and thus tend to suffer higher loss. Worse, as model accuracy affects user retention, a minority group can shrink over time. In this paper, we first show that the status quo of empirical risk minimization (ERM) amplifies representation disparity over time, which can even make initially fair models unfair. To mitigate this, we develop an approach based on distributionally robust optimization (DRO), which minimizes the worst case risk over all distributions close to the empirical distribution. We prove that this approach controls the risk of the minority group at each time step, in the spirit of Rawlsian distributive justice, while remaining oblivious to the identity of the groups. We demonstrate that DRO prevents disparity amplification on examples where ERM fails, and show improvements in minority group user satisfaction in a real-world text autocomplete task.", "title": "Fairness Without Demographics in Repeated Loss Minimization"}