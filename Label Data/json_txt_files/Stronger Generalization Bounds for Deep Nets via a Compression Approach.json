{"sections": [{"heading": "1. Introduction", "text": "A mystery about deep nets is that they generalize (i.e., predict well on unseen data) despite having far more parameters than the number of training samples. One commonly voiced explanation is that regularization during training \u2013whether implicit via use of SGD (Neyshabur et al., 2015c; Hardt et al., 2016) or explicit via weight decay, dropout (Srivastava et al., 2014), batch normalization (Ioffe and Szegedy, 2015), etc. \u2013reduces the effective capacity of the net. But Zhang et al. (2017) questioned this received wisdom and\nAuthors listed in alphabetical order 1Princeton University, Computer Science Department 2Duke University, Computer Science Department 3Institute for Advanced Study, School of Mathematics. Correspondence to: Rong Ge <rongge@cs.duke.edu>, Behnam Neyshabur <bneyshabur@ias.edu>, Yi Zhang <y.zhang@cs.princeton.edu>.\nProceedings of the 35 th International Conference on Machine Learning, Stockholm, Sweden, PMLR 80, 2018. Copyright 2018 by the author(s).\nfueled research in this area by showing experimentally that standard architectures using SGD and regularization can still reach low training error on randomly labeled examples (which clearly won\u2019t generalize).\nClearly, deep nets trained on real-life data have some properties that reduce effective capacity, but identifying them has proved difficult \u2014at least in a quantitative way that yields sample size upper bounds similar to classical analyses in simpler models such as SVMs (Bartlett and Mendelson, 2002; Evgeniou et al., 2000; Smola et al., 1998) or matrix factorization (Fazel et al., 2001; Srebro et al., 2005).\nQualitatively (Hochreiter and Schmidhuber, 1997; Hinton and Van Camp, 1993) suggested that nets that generalize well are flat minima in the optimization landscape of the training loss. Recently Keskar et al. (2016) show using experiments with different batch-sizes that sharp minima do correlate with higher generalization error. A quantitative version of \u201cflatness\u201d was suggested in (Langford and Caruana, 2001): the net\u2019s output is stable to noise added to the net\u2019s trainable parameters. Using PAC-Bayes bound (McAllester, 1998; 1999) this noise stability yielded generalization bounds for fully connected nets of depth 2. The theory has been extended to multilayer fully connected nets (Neyshabur et al., 2017b), although thus far yields sample complexity bounds much worse than naive parameter counting. (Same holds for the earlier Bartlett and Mendelson (2002); Neyshabur et al. (2015b); Bartlett et al. (2017); Neyshabur et al. (2017a); Golowich et al. (2017); see Figure 3). Another notion of noise stability \u2014closely related to dropout and batch normalization\u2014is stability of the output with respect to the noise injected at the nodes of the network, which was recently shown experimentally (Morcos et al., 2018) to improve in tandem with generalization ability during training, and to be absent in nets trained on random data. Chaudhari et al. (2016) suggest adding noise to gradient descent to bias it towards finding flat minima.\nWhile study of generalization may appear a bit academic \u2014 held-out data easily establishes generalization in practice\u2014 the ultimate hope is that it will help identify simple, measurable and intuitive properties of well-trained deep nets, which in turn may fuel superior architectures and faster training. We hope the detailed study \u2014theoretical and empirical\u2014in the current paper advances this goal.\nContributions of this paper. 1. A simple compression framework (Section 2) for prov-\ning generalization bounds, perhaps a more explicit and intuitive form of the PAC-Bayes work. It also yields elementary short proofs of recent generalization results (Section 2.2).\n2. Identifying new form of noise-stability for deep nets: the stability of each layer\u2019s computation to noise injected at lower layers. (Earlier papers worked only with stability of the output layer.) Figure 1 visualizes the stability of network w.r.t. Gaussian injected noise. Formal statements require a string of other properties (Section 3). All are empirically studied, including their correlation with generalization (Section 6).\n3. Using the above properties to derive efficient and provably correct algorithms that reduce the effective number of parameters in the nets, yielding generalization bounds that: (a) are better than naive parameter counting (Section 6) (b) depend on simple, intuitive and measurable properties of the network (Section 4) (c) apply also to convolutional nets (Section 5) (d) empirically correlate with generalization (Section 6).\nThe main idea is to show that noise stability allows individual layers to be compressed via a linear-algebraic procedure Algorithm 1. This results in new error in the output of the layer. This added error is \u201cGaussian-like\u201d and tends to get attenuated as it propagates to higher layers.\nOther related works. Dziugaite and Roy (2017) use nonconvex optimization to optimize the PAC-Bayes bound and get a non-vacuous sample bound on MNIST. While very creative, this provides little insight into favorable properties of networks. Liang et al. (2017) have suggested FisherRao metric, a regularization based on the Fisher matrix and showed that this metric correlate with generalization. Unfortunately, they could only apply their method to linear\nnetworks. Recently Kawaguchi et al. (2017) connects PathNorm (Neyshabur et al., 2015a) to generalization. However, the proved generalization bound depends on the distribution and measuring it requires vector operations on exponentially high dimensional vectors. Other works have designed experiments to empirically evaluate potential properties of the network that helps generalization(Arpit et al., 2017; Neyshabur et al., 2017b; Dinh et al., 2017). The idea of compressing trained deep nets is very popular for low-power applications; for a survey see Cheng et al. (2018).\nFinally, note that the terms compression and stability are traditionally used in a different sense in generalization theory (Littlestone and Warmuth, 1986; Kearns and Ron, 1999; Shalev-Shwartz et al., 2010). Our framework is compared to other notions in the remarks after Theorem 2.1.\nNotation: We use standard formalization of multiclass classification, where data consists of sample x and its label y (an integer from 1 to k). A multiclass classifier f maps input x to f(x) \u2208 Rk and the maximum coordinate of f(x) is the predicted label. The classification loss for any distribution D is defined as P(x,y)\u223cD [f(x)[y] < maxi6=y f(x)[j]] where f(x)[y] is the y-th coordinate of f(x). If \u03b3 > 0 is some desired margin, then the expected margin loss is\nL\u03b3(f) = P(x,y)\u223cD [ f(x)[y] \u2264 \u03b3 + max\ni6=y f(x)[j] ] (Notice, the classification loss corresponds to \u03b3 = 0.) Let L\u0302\u03b3 denote empirical estimate of the margin loss. Generalization error is the difference between the two.\nFor most of the paper we assume that deep nets have fully connected layers, and use ReLU activations. We treat convolutional nets in Section 5. If the net has d layers, we label the vector before activation at these layers by x0, x1, xd for the d layers where x0 is the input to the net, also denoted simply x. So xi = Ai\u03c6(xi\u22121) where Ai is the weight matrix of the ith layer. (Here \u03c6(x) if x is a vector applies the ReLU component-wise. The ReLU is allowed a trainable bias parameter, which is omitted from the notation because it has no effect on any calculations below.) We denote the number of hidden units in layer i by hi and set h = maxdi=1 h\ni. Let fA(x) be the function calculated by the above network.\nStable rank of a matrix B is \u2016B\u20162F /\u2016B\u201622, where \u2016 \u00b7 \u2016F denotes Frobenius norm and \u2016 \u00b7 \u20162 denotes spectral norm. Note that stable rank is at most (linear algebraic) rank.\nFor any two layer i \u2264 j, denote by M i,j the operator for composition of these layers and J i,jx be the Jacobian of this operator at input x (a matrix whose p, q is the partial derivative of the pth output coordinate with respect to the q\u2019th input input). Therefore, we have xj = M i,j(xi). Furthermore, since the activation functions are ReLU, we have\nM i,j(xi) = J i,jxi x i."}, {"heading": "2. Compression and Generalization", "text": "Our compression framework rests on the following obvious fact. Suppose the training data contains m samples, and f is a classifier from a complicated class (e.g., deep nets with much more than m parameters) that incurs very low empirical loss. We are trying to understand if it will generalize. Now suppose we can compute a classifier g with discrete trainable parameters much less than m and which incurs similar loss on the training data as f . Then g must incur low classification error on the full distribution. This framework has the advantage of staying with intuitive parameter counting and to avoid explicitly dealing with the hypothesis class that includes f (see note after Theorem 2.1). Notice, the mapping from f to g merely needs to exist, not to be efficiently computable. But in all our examples the mapping will be explicit and fairly efficient. Now we formalize the notions. The proofs are elementary via concentration bounds and appear in the appendix.\nDefinition 1 ((\u03b3,S)-compressible). For any set A of parameter values, let f be a classifier and GA = {gA|A \u2208 A} be a class of classifiers. We say f is (\u03b3, S)-compressible via GA if there exists A \u2208 A such that for any x \u2208 S, we have for all y\n|f(x)[y]\u2212 gA(x)[y]| \u2264 \u03b3.\nWe also consider a different setting where the compression algorithm is allowed a\u201chelper string\u201d s, which is arbitrary but fixed before looking at the training samples. Often s will contain random numbers. A simple example is to let s be the random initialization used for training the deep net and then compress the difference between the final weights and s. This can give better generalization bounds, similar to (Dziugaite and Roy, 2017). Other nontrivial examples appear later.\nDefinition 2 ((\u03b3,S)-compressible using helper string s). Suppose GA,s = {gA,s|A \u2208 A} is a class of classifiers indexed by trainable parameters A and fixed strings s. A classifier f is (\u03b3, S)-compressible with respect to GA,s using helper string s if there exists A \u2208 A such that for any x \u2208 S, we have for all y\n|f(x)[y]\u2212 gA,s(x)[y]| \u2264 \u03b3.\nTheorem 2.1. Suppose GA,s = {gA,s|A \u2208 A} where A is a set of q parameters each of which can have at most r discrete values and s is a helper string. Let S be a training set with m samples. For any margin \u03b3 > 0, if the trained classifier f is (\u03b3, S)-compressible via GA,s with helper string s, then there exists A \u2208 A such that with high probability\nover the training set,\nL0(gA) \u2264 L\u0302\u03b3(f) +O (\u221a q log r\nm\n) .\nRemarks: (1) The framework proves the generalization not of f but of its compression gA. (An exception is if the two are shown to have similar loss at every point in the domain, not just the training set. This is the case in Theorem 2.2.) (2) The previous item highlights how our framework steps away from uniform convergence framework, e.g., covering number arguments (Dudley, 2010; Anthony and Bartlett, 2009). There, one needs to fix a hypothesis class independent of the training set. By contrast we have no hypothesis class, only a single neural net that has some specific properties (described in Section 3) on a single finite training set. But if we can compress this specific neural net to a simpler neural nets with fewer parameters then we can use covering number argument on this simpler class to get the generalization of the compressed net. (3) Issue (1) exists also in standard PAC-Bayes framework for deep nets (see tongue-in-cheek title of Langford and Caruana (2001)). They yield generalization bounds not for f but for a noised version of f (i.e., net given by W + \u03b7, where W is parameter vector of f and \u03b7 is a noise vector). (4) As we will see later, our compression which is achieved via a randomized algorithm seems \u201cnon-destructive\u201d and should not overfit to the training set more than the original network. Moreover, for us issue (1) could be fixed by showing that if f satisfies the properties of Section 3 on training data then it satisfies them on the entire domain. This is left for future work."}, {"heading": "2.1. Example 1: Linear classifiers with margin", "text": "To illustrate the above compression method and its connection to noise stability, we use linear classifiers with high margins. Let c \u2208 Rh(\u2016c\u2016 = 1) be a classifier for binary classification whose output on input x is sgn(c \u00b7 x). Let D be a distribution on inputs (x, y) where \u2016x\u2016 = 1 and y \u2208 {\u00b11}. Say c has margin \u03b3 if for all (x, y) in the training set we have y(c>x) \u2265 \u03b3. If we add Gaussian noise vector \u03b7 with coordinate-wise variance \u03c32 to c, then E[x \u00b7 (c+ \u03b7)] is c \u00b7 x and the variance is \u03c32. (A similar analysis applies to noising of x instead of c.) Thus the margin is large if and only if the classifier\u2019s output is somewhat noise-stable.\nA classifier with margin \u03b3 can be compressed to one that has onlyO(1/\u03b32) non-zero entries. For each coordinate i, toss a coin with Pr[heads] = 8c2i /\u03b3\n2 and if it comes up heads set the coordinate to equal to \u03b32/8ci (see Algorithm 2 in supplementary material). This yields a vector c\u0302 with only O(1/\u03b32) nonzero entries such that for any vector u, with reasonable\nprobability |c\u0302>u\u2212 c>u| \u2264 \u03b3, so c\u0302 and c will make the same prediction. We can then apply Theorem 2.1 on a discretized version of c\u0302 to show that the sparsified classifier has good generalization with O(log d/\u03b32) samples.\nThis compressed classifier works correctly for a fixed input x with good probability but not high probability. To fix this, one can recourse to the \u201ccompression with fixed string\u201d model. The fixed string is a random linear transformation. When applied to unit vector x, it tends to equalize all coordinates and the guarantee |c\u0302>u\u2212 c>u| \u2264 \u03b3 can hold with high probability. This random linear transformation can be fixed before seeing the training data. See Section A.2 in supplementary material for details."}, {"heading": "2.2. Example 2: Existing generalization bounds", "text": "Our compression framework gives easy and short proof of the generalization bounds of a recent paper; see appendix for slightly stronger result of Bartlett et al. (2017).\nTheorem 2.2. ((Neyshabur et al., 2017a)) For any deep net with layers A1, A2, . . . Ad and output margin \u03b3 on a training set S, the generalization error can be bounded by\nO\u0303  \u221a\u221a\u221a\u221ahd2 maxx\u2208S \u2016x\u2016\u220fdi=1 \u2016Ai\u201622\u2211di=1 \u2016Ai\u20162F\u2016Ai\u201622\n\u03b32m\n .\nThe second part of this expression ( \u2211d i=1 \u2016Ai\u20162F \u2016Ai\u201622\n) is sum of stable ranks of the layers, a natural measure of their true parameter count. The first part ( \u220fd i=1 \u2016Ai\u201622) is related to the Lipschitz constant of the network, namely, the maximum norm of the vector it can produce if the input is a unit vector. The Lipschitz constant of a matrix operator B is just its spectral norm \u2016B\u20162. Since the network applies a sequence of matrix operations interspersed with ReLU, and ReLU is 1-Lipschitz we conclude that the Lipschitz constant of the full network is at most \u220fd i=1 \u2016Ai\u20162.\nTo prove Theorem 2.2 we use the following lemma to compress the matrix at each layer to a matrix of smaller rank. Since a matrix of rank r can be expressed as the product of two matrices of inner dimension r, it has 2hr parameters (instead of the trivial h2). (Furthermore, the parameters can be discretized via trivial rounding to get a compression with discrete parameters as needed by Definition 1.)\nLemma 1. For any matrix A \u2208 Rm\u00d7n, let A\u0302 be the truncated version of A where singular values that are smaller than \u03b4\u2016A\u20162 are removed. Then \u2016A\u0302\u2212A\u20162 \u2264 \u03b4\u2016A\u20162 and A\u0302 has rank at most \u2016A\u20162F /(\u03b42\u2016A\u201622).\nProof. Let r be the rank of A\u0302. By construction, the maximum singular value of A\u0302 \u2212 A is at most \u03b4\u2016A\u20162. Since\nthe remaining singular values are at least \u03b4\u2016A\u20162, we have \u2016A\u2016F \u2265 \u2016A\u0302\u2016F \u2265 \u221a r\u03b4\u2016A\u20162.\nFor each i replace layer i by its compression using the above lemma, with \u03b4 = \u03b3(3\u2016x\u2016d\u220fdi=1 \u2016Ai\u20162)\u22121. How much error does this introduce at each layer and how much does it affect the output after passing through the intermediate layers (and getting magnified by their Lipschitz constants)? Since A \u2212 A\u0302i has spectral norm (i.e., Lipschitz constant) at most \u03b4, the error at the output due to changing layer i in isolation is at most \u03b4\u2016xi\u2016\u220fdj=1 \u2016Aj\u20162 \u2264 \u03b3/3d. A simple induction (see (Neyshabur et al., 2017a) if needed) can now show the total error incurred in all layers is bounded by \u03b3. The generalization bound follows immediately from Theorem 2.1."}, {"heading": "3. Noise Stability Properties of Deep Nets", "text": "This section introduces noise stability properties of deep nets that imply better compression (and hence generalization). They help overcome the pessimistic error analysis of our proof of Theorem 2.2: when a layer was compressed, the resulting error was assumed to blow up in a worst-case manner according to the Lipschitz constant (namely, product of spectral norms of layers). This hurt the amount of compression achievable. The new noise stability properties roughly amount to saying that noise injected at a layer has very little effect on the higher layers. Our formalization starts with noise sensitivity, which captures how an operator transmits noise vs signal.\nDefinition 3. IfM is a mapping from real-valued vectors to real-valued vectors, and N is some noise distribution then noise sensitivity of M at x with respect to N , is\n\u03c8N (M,x) = E\u03b7\u2208N [\u2016M(x+ \u03b7\u2016x\u2016)\u2212M(x)\u20162 \u2016M(x)\u20162 ] ,\nThe noise sensitivity of M with respect to N on a set of inputs S, denoted \u03c8N ,S(M), is the maximum of \u03c8N (M,x) over all inputs x in S.\nTo illustrate, we examine noise sensitivity of a matrix (i.e., linear mapping) with respect to Gaussian distribution. Low sensitivity turns out to imply that the matrix has some large singular values (i.e., low stable rank), which give directions that can preferentially carry the \u201csignal\u201dx whereas noise \u03b7 attenuates because it distributes uniformly across directions.\nProposition 3.1. The noise sensitivity of a matrix M at any vector x 6= 0 with respect to Gaussian distribution N (0, I) is exactly \u2016M\u20162F \u2016x\u20162/\u2016Mx\u20162, and at least its stable rank.\nProof. Using E[\u03b7\u03b7>] = I , we bound the numerator by\nE\u03b7[\u2016M(x+ \u03b7\u2016x\u2016)\u2212Mx\u20162] = E\u03b7[\u2016x\u20162\u2016M\u03b7\u20162]\n= E\u03b7[\u2016x\u20162tr(M\u03b7\u03b7>M>)] = \u2016x\u20162tr(MM>) = \u2016M\u20162F \u2016x\u20162.\nThus noise sensitivity \u03c8 at x is \u2016M\u20162F \u2016x\u20162/\u2016Mx\u20162, which is at least the stable rank \u2016M\u20162F /\u2016M\u201622 since \u2016Mx\u2016 \u2264 \u2016M\u20162\u2016x\u2016.\nThe above proposition suggests that if a vector x is aligned to a matrix M (i.e. correlated with high singular directions of M ), then matrix M becomes less sensitive to noise at x. This intuition will be helpful in understanding the properties we define later to formalize noise stability.\nThe above discussion motivates the following approach. We compress each layer i by an appropriate randomized compression algorithm, such that the noise/error in its output is \u201cGaussian-like\u201d. If layers i + 1 and higher have low sensitivity to this new noise, then the compression can be more extreme produce much higher noise. We formalize this idea using Jacobian J i,j , which describes instantaneous change of M i,j(x) under infinitesimal perturbation of x."}, {"heading": "3.1. Formalizing Error-resilience", "text": "Now we formalize the error-resilience properties. Section 6 reports empirical findings about these properties. The first is cushion, to be thought of roughly as reciprocal of noise sensitivity. We first formalize it for single layer. Definition 4 (layer cushion). The layer cushion of layer i is similarly defined to be the largest number \u00b5i such that for any x \u2208 S, \u00b5i\u2016Ai\u2016F \u2016\u03c6(xi\u22121)\u2016 \u2264 \u2016Ai\u03c6(xi\u22121)\u2016.\nIntuitively, cushion considers how much smaller the output Ai\u03c6(xi\u22121) is compared to the upper bound \u2016Ai\u2016F \u2016\u03c6(xi\u22121)\u2016. Using argument similar to Proposition 3.1, we can see that 1/\u00b52i is equal to the noise sensitivity of matrixAi at input \u03c6(xi\u22121) with respect to Gaussian noise \u03b7 \u223c N (0, I). Of course, for nonlinear operators the definition of error resilience is less clean. Let\u2019s denote by M i,j : Rhi \u2192 Rhj the operator corresponding to the portion of the deep net from layer i to layer j, and by J i,j its Jacobian. If infinitesimal noise is injected before level i then M i,j passes it like J i,j , a linear operator. When the noise is small but not infinitesimal then one hopes that M i,j still behaves roughly linearly (recall that ReLU nets are piecewise linear). To formalize this, we define Interlayer Cushion (Definition 5) that captures the local linear approximation of the operator M . Definition 5 (Interlayer Cushion). For any two layers i \u2264 j, we define the interlayer cushion \u00b5i,j as the largest number such that for any x \u2208 S:\n\u00b5i,j\u2016J i,jxi \u2016F \u2016xi\u2016 \u2264 \u2016J i,j xi x i\u2016\nFurthermore, for any layer i we define the minimal interlayer cushion as \u00b5i\u2192 = mini\u2264j\u2264d \u00b5i,j = min{1/ \u221a hi,mini<j\u2264d \u00b5i,j}1.\nSince J i,jx is a linear transformation, a calculation similar to Proposition 3.1 shows that its noise sensitivity at xi with respect to Gaussian distribution N (0, I) is at most 1\n\u00b52ij .\nThe next property quantifies the intuitive observation on the learned networks that for any training data, almost half of the ReLU activations at each layer are active. If the input to the activations is well-distributed and the activations do not correlate with the magnitude of the input, then one would expect that on average, the effect of applying activations at any layer is to decrease the norm of the pre-activation vector by at most some small constant factor. Definition 6 (Activation Contraction). The activation contraction c is defined as the smallest number such that for any layer i and any x \u2208 S,\n\u2016\u03c6(xi)\u2016 \u2265 \u2016xi\u2016/c.\nWe discussed how the interlayer cushion captures noiseresilience of the network if behaves linearly, namely, when the set of activated ReLU gates does not change upon injecting noise. In general the activations do change, but the deviation from linear behavior is bounded for small noise vectors, as quantified next. Definition 7 (Interlayer Smoothness). Let \u03b7 be the noise generated as a result of substituting weights in some of the layers before layer i using Algorithm 1. We define interlayer smoothness \u03c1\u03b4 to be the largest number such that with probability 1\u2212 \u03b4 over noise \u03b7 for any two layers i < j any x \u2208 S:\n\u2016M i,j(xi + \u03b7)\u2212 J i,jxi (xi + \u03b7)\u2016 \u2264 \u2016\u03b7\u2016\u2016xj\u2016 \u03c1\u03b4\u2016xi\u2016 .\nFor a single layer, \u03c1\u03b4 captures the ratio of input/weight alignment to noise/weight alignment. Since the noise behaves similar to Gaussian, one expects this number to be greater than one for a single layer. When j > i + 1, the weights and activations create more dependencies. However, since these dependences are applied on both noise and input, we again expect that if the input is more aligned to the weights than noise, this should not change in higher layers. In Section 6, we show that the interlayer smoothness is indeed good: 1/\u03c1\u03b4 is a small constant. Please see Appendix A.4 for a more detailed discussion on interlayer smoothness."}, {"heading": "4. Fully Connected Networks", "text": "We prove generalization bounds using for fully connected multilayer nets. Details appear in Appendix Section B.\n1Note that J i,i xi\n= I and \u00b5i,i = 1/ \u221a hi\nTheorem 4.1. For any fully connected network fA with \u03c1\u03b4 \u2265 3d, any probability 0 < \u03b4 \u2264 1 and any margin \u03b3, Algorithm 1 generates weights A\u0303 for the network fA\u0303 such that with probability 1\u2212 \u03b4 over the training set and fA\u0303, the expected error L0(fA\u0303) is bounded by\nL\u0302\u03b3(fA) + O\u0303  \u221a\u221a\u221a\u221ac2d2 maxx\u2208S \u2016fA(x)\u201622\u2211di=1 1\u00b52i\u00b52i\u2192\n\u03b32m  where \u00b5i, \u00b5i\u2192, c and \u03c1\u03b4 are layer cushion, interlayer cushion, activation contraction and interlayer smoothness defined in Definitions 4,5,6 and 7 respectively.\nTo prove this we describe a compression of the net with respect to a fixed (random) string. In contrast to the deterministic compression of Lemma 1, this randomized compression ensures that the resulting error in the output behaves like a Gaussian. The proofs are similar to standard JL dimension reduction.\nAlgorithm 1 Matrix-Project (A, \u03b5, \u03b7)\nRequire: Layer matrix A \u2208 Rh1\u00d7h2 , error parameter \u03b5, \u03b7. Ensure: Returns A\u0302 s.t. \u2200 fixed vectors u, v,\nPr[|u>A\u0302v \u2212 u>Av\u2016 \u2265 \u03b5\u2016A\u2016F \u2016u\u2016\u2016v\u2016] \u2264 \u03b7.\nSample k = log(1/\u03b7)/\u03b52 random matrices M1, . . . ,Mk with entries i.i.d. \u00b11 (\u201chelper string\u201d) for k\u2032 = 1 to k do\nLet Zk\u2032 = \u3008A,Mk\u2032\u3009Mk\u2032 . end for Let A\u0302 = 1k \u2211k k\u2032=1 Zk\u2032\nNote that the helper string of random matrices Mi\u2019s were chosen and fixed before training set S was picked. Each weight matrix is thus represented as only k real numbers \u3008A,Mi\u3009 for i = 1, 2, ..., k. Lemma 2. For any 0 < \u03b4, \u03b5 \u2264 1, let G = {(U i, xi)}mi=1 be a set of matrix/vector pairs of sizem where U \u2208 Rn\u00d7h1 and x \u2208 Rh2 , let A\u0302 \u2208 Rh1\u00d7h2 be the output of Algorithm 1 with \u03b7 = \u03b4/mn and \u2206 = A\u0302\u2212A. With probability at least 1\u2212 \u03b4 we have for any (U, x) \u2208 G, \u2016U\u2206x\u2016 \u2264 \u03b5\u2016A\u2016F \u2016U\u2016F \u2016x\u2016.\nNext Lemma bounds the number of parameters of the compressed network resulting from applying Algorithm 1 to all the layer matrices of the net. The proof does induction on the layers and bounds the effect of the error on the output of the network using properties defined in Section 3.1.\nLemma 3. For any fully connected network fA with \u03c1\u03b4 \u2265 3d, any probability 0 < \u03b4 \u2264 1 and any error 0 < \u03b5 \u2264 1, Algorithm 1 generates weights A\u0303 for a network with 72c2d2 log(mdh/\u03b4)\n\u03b52 \u00b7 \u2211d i=1 1 \u00b52i\u00b5 2 i\u2192 total parameters such that\nwith probability 1\u2212 \u03b4/2 over the generated weights A\u0303, for any x \u2208 S:\n\u2016fA(x)\u2212 fA\u0303(x)\u2016 \u2264 \u03b5\u2016fA(x)\u2016.\nwhere \u00b5i, \u00b5i\u2192, c and \u03c1\u03b4 are layer cushion, interlayer cushion, activation contraction and interlayer smoothness defined in Definitions 4,5,6 and 7 respectively.\nSome obvious improvements: (i) Empirically it has been observed that deep net training introduces fairly small changes to parameters as compared to the (random) initial weights (Dziugaite and Roy, 2017). We can exploit this by incorporating the random initial weights into the helper string and do the entire proof above not with the layer matrices Ai but only the difference from the initial starting point. Experiments in Section 6 show this improves the bounds. (ii) Cushions and other quantities defined earlier are datadependent, and required to hold for the entire training set. However, the proofs go through if we remove say \u03b6 fraction of outliers that violate the definitions; this allows us to use more favorable values for cushion etc. and lose an additive factor \u03b6 in the generalization error."}, {"heading": "5. Convolutional Neural Networks", "text": "Now we sketch how to provably compress convolutional nets. (Details appear in Section C of supplementary.) Intuitively, this feels harder because the weights are already compressed\u2014 they\u2019re shared across patches!\nTheorem 5.1. For any convolutional neural network fA with \u03c1\u03b4 \u2265 3d, any probability 0 < \u03b4 \u2264 1 and any margin \u03b3, Algorithm 4 generates weights A\u0303 for the network fA\u0303 such that with probability 1\u2212 \u03b4 over the training set and fA\u0303:\nL0(fA\u0303) \u2264 L\u0302\u03b3(fA)\n+ O\u0303  \u221a\u221a\u221a\u221ac2d2 maxx\u2208S \u2016fA(x)\u201622\u2211di=1 \u03b22(d\u03bai/sie)2\u00b52i\u00b52i\u2192\n\u03b32m  where \u00b5i, \u00b5i\u2192, c, \u03c1\u03b4 and \u03b2 are layer cushion, interlayer cushion, activation contraction, interlayer smoothness and well-distributed Jacobian defined in Definitions 4,8,6, 7 and 9 respectively. Furthermore, si and \u03bai are stride and filter width in layer i.\nLet\u2019s realize that obvious extensions of earlier sections fail. Suppose layer i of the neural network is an image of dimension ni1 \u00d7 ni2 and each pixel has hi channels, the size of the filter at layer i is \u03bai \u00d7 \u03bai with stride si. The convolutional filter has dimension hi\u22121 \u00d7 hi \u00d7 \u03bai \u00d7 \u03bai. Applying matrix compression (Algorithm 1) independently to each copy of a convolutional filter makes number of new parameters proportional to ni1n i 2, a big blowup.\nCompressing a convolutional filter once and reusing it in all patches doesn\u2019t work because the interlayer analysis implicitly requires the noise generated by the compression behave similar to a spherical Gaussian, but the shared filters introduce correlations. Quantitatively, using the fully connected analysis would require the error to be less than interlayer cushion value \u00b5i\u2192 (Definition 5) which is at most 1/ \u221a hini1n i 2, and this can never be achieved from compressing matrices that are far smaller than ni1 \u00d7 ni2 to begin with. We end up with a solution in between fully independent and fully dependent: p-wise independence. The algorithm generates p-wise independent compressed filters A\u0302(a,b) for each convolution location (a, b) \u2208 [ni1]\u00d7 [ni2]. It results in p times more parameters than a single compression. If p grows logarithmically with relevant parameters, the filters behave like fully independent filters. Using this idea we can generalize the definition of interlayer margin to the convolution setting: Definition 8 (Interlayer Cushion, Convolution Setting). For any two layers i \u2264 j, we define the interlayer cushion \u00b5i,j as the largest number such that for any x \u2208 S:\n\u00b5i,j \u00b7 1\u221a ni1n i 2 \u2016J i,jxi \u2016F \u2016xi\u2016 \u2264 \u2016J i,j xi x i\u2016\nFurthermore, for any layer i we define the minimal interlayer cushion as \u00b5i\u2192 = mini\u2264j\u2264d \u00b5i,j = min{1/ \u221a hi,mini<j\u2264d \u00b5i,j}2.\nRecall that interlayer cushion is related to the noise sensitivity of J i,jxi at x\ni with respect to Gaussian distribution N (0, I). When we consider J i,jxi applied to a noise \u03b7, if different pixels in \u03b7 are independent Gaussian random variables, then we can indeed expect \u2016J i,jxi \u03b7\u2016 \u2248 1\u221a hini1n i 2 \u2016J i,jxi \u2016\u2016\u03b7\u2016, which explains the extra 1\u221ani1ni2 factor in Definition 8 compared to Definition 5. The proof also needs to assume \u2014in line with intuition behind convolution architecture\u2014 that information from the entire image field is incorporated somewhat uniformly across pixels. It is formalized using the Jacobian which gives the partial derivative of the output with respect to pixels at previous layer. Definition 9 (Well-distributed Jacobian). Let J i,jx be the Jacobian of M i,j at x, we know J i,jx \u2208 Rhi\u00d7ni1\u00d7ni2\u00d7hj\u00d7n j 1\u00d7n j 2 . We say the Jacobian is \u03b2 welldistributed if for any x \u2208 S, any i, j, any (a, b) \u2208 [ni1\u00d7ni2],\n\u2016[J i,jx ]:,a,b,:,:,:\u2016F \u2264 \u03b2\u221a ni1n i 2 \u2016J i,jx \u2016F"}, {"heading": "6. Empirical Evaluation", "text": "We study noise stability properties (defined in Section 3) of an actual trained deep net, and compute a generalization\n2Note that J i,i xi\n= I and \u00b5i,i = 1/ \u221a hi\nbound from Theorem 5.1. Experiments were performed by training a VGG-19 architecture (Simonyan and Zisserman, 2014) and a AlexNet (Krizhevsky et al., 2012) for multi-class classification task on CIFAR-10 dataset. Optimization used SGD with mini-batch size 128, weight decay 5e-4, momentum 0.9 and initial learning rate 0.05, but decayed by factor 2 every 30 epochs. Drop-out was used in fully-connected layers. We trained both networks for 299 epochs and the final VGG-19 network achieved 100% training and 92.45% validation accuracy while the AlexNet achieved 100% training and 77.22% validation accuracy. To investigate the effect of corrupted label, we trained another AlexNet, which 100% training and 9.86% validation accuracy, on CIFAR-10 dataset with randomly shuffled labels.\nOur estimate of the sample complexity bound used exact computation of norms of weight matrices (or tensors) in all bounds(||A||1,\u221e, ||A||1,2, ||A||2, ||A||F ). Like previous bounds in generalization theory, ours also depend upon nuisance parameters like depth d, logarithm of h, etc. which probably are an artifact of the proof. These are ignored in the computation (also in computing earlier bounds) for simplicity. Even the generalization based on parameter counting arguments does have an extra dependence on depth (Bartlett et al., 2017). A recent work, (Golowich et al., 2017) showed that many such depth dependencies can be improved."}, {"heading": "6.1. Empirical investigation of noise stability properties", "text": "Section 3 identifies four properties in the networks that contribute to noise-stability: layer cushion, interlayer cushion, contraction, interlayer smoothness. Figure 2 plots the distribution of over different data points in the training set and compares to a Gaussian random network and then scaled properly. The layer cushion, which quantifies its noise stability, is drastically improved during the training, especially for the higher layers (8 and higher) where most parameters live. Moreover, we observe that interlayer cushion, activation contraction and interlayer smoothness behave nicely even after training. These plots suggest that the driver of the generalization phenomenon is layer cushion. The other properties are being maintained in the network and prevent the network from falling prey to pessimistic assumptions that causes the other older generalization bounds to be very high. The assumptions made in section 3 (also in B.1) are verified on the VGG-19 net in appendix D.1 by histogramming the distribution of layer cushion, interlayer cushion, contraction, interlayer smoothness, and well-distributedness of the Jacobians of each layer of the net on each data point in the training set. Some examples are shown in Figure 2."}, {"heading": "6.2. Correlation to generalization error", "text": "We evaluate our generalization bound during the training, see Figure 3, Right. After 120 epochs, the training error is\nalmost zero but the test error continues to improve in later epochs. Our generalization bound continues to improve, though not to the same level. Thus our generalization bound captures part of generalization phenomenon, not all. Still, this suggests that SGD somehow improves our generalization measure implicitly. Making this rigorous is a good topic for further research.\nFurthermore, we investigate effect of training with normal data and corrupted data by training two AlexNets respectively on original and corrupted CIFAR-10 with randomly shuffled labels. We identify two key properties that differ significantly between the two networks: layer cushion and activation contraction, see D.2. Since our bound predicts larger cushion and lower contraction indicates better generalization, our bound is consistent w with the fact that the net trained on normal data generalizes (77.22% validation accuracy)."}, {"heading": "6.3. Comparison to other generalization bounds", "text": "Figure 3 compares our proposed bound to other neural-net generalization bounds on the VGG-19 net and compares to naive VC dimension bound (which of course is too pessimistic). All previous generalization bounds are orders of magnitude worse than ours; the closest one is spectral norms times average `1,2 of the layers (Bartlett et al., 2017) which is still about 1018, far greater than VC dimension. (As mentioned we\u2019re ignoring nuisance factors like depth\nand log h which make the comparison to VC dimension a bit unfair, but the comparison to previous bounds is fair.) This should not be surprising as all other bounds are based on product of norms is pessimistic (see note at the start of Section 3) which we avoid due to the noise stability analysis resulting in a bound that has more dependence on the data.\nTable 1 shows the compressibility of various layers according to the bounds given by our theorem. Again, this is a qualitative due to ignoring nuisance factors, but it gives an idea of which layers are important in the calculation."}, {"heading": "7. Conclusions", "text": "With a new compression-based approach, the paper has made progress on several open issues regarding generalization properties of deep nets. The approach also adapts specially to convolutional nets. The empirical verification of the theory in Section 6 shows a rich set of new properties satisfied by deep nets trained on realistic data, which we hope will fuel further theory work on deep learning, including how these properties play into optimization and expressivity. Another possibility is a more rigorous understanding of deep net compression, which sees copious empirical work motivated by low-power applications. Perhaps our p-wise independence idea used for compressing convnets (Section 5) has practical implications."}, {"heading": "Acknowledgments", "text": "This research was done with support from NSF, ONR, Darpa, SRC, Simons Foundation, Mozilla Research, and Schmidt Foundation."}], "year": 2018, "references": [{"title": "Neural network learning: Theoretical foundations", "authors": ["Martin Anthony", "Peter L Bartlett"], "venue": "cambridge university press,", "year": 2009}, {"title": "A closer look at memorization in deep networks", "authors": ["Devansh Arpit", "Stanislaw Jastrzebski", "Nicolas Ballas", "David Krueger", "Emmanuel Bengio", "Maxinder S Kanwal", "Tegan Maharaj", "Asja Fischer", "Aaron Courville", "Yoshua Bengio"], "venue": "arXiv preprint arXiv:1706.05394,", "year": 2017}, {"title": "Spectrally-normalized margin bounds for neural networks", "authors": ["Peter Bartlett", "Dylan J Foster", "Matus Telgarsky"], "venue": "arXiv preprint arXiv:1706.08498,", "year": 2017}, {"title": "Rademacher and gaussian complexities: Risk bounds and structural results", "authors": ["Peter L Bartlett", "Shahar Mendelson"], "venue": "Journal of Machine Learning Research,", "year": 2002}, {"title": "Entropy-sgd: Biasing gradient descent into wide valleys", "authors": ["Pratik Chaudhari", "Anna Choromanska", "Stefano Soatto", "Yann LeCun"], "venue": "arXiv preprint arXiv:1611.01838,", "year": 2016}, {"title": "Model compression and acceleration for deep neural networks: The principles, progress, and challenges", "authors": ["Yu Cheng", "Duo Wang", "Pan Zhou", "Tao Zhang"], "venue": "IEEE Signal Proc. Magazine,", "year": 2018}, {"title": "Sharp minima can generalize for deep nets", "authors": ["Laurent Dinh", "Razvan Pascanu", "Samy Bengio", "Yoshua Bengio"], "venue": "arXiv preprint arXiv:1703.04933,", "year": 2017}, {"title": "Universal donsker classes and metric entropy", "authors": ["Richard M Dudley"], "venue": "In Selected Works of RM Dudley,", "year": 2010}, {"title": "Computing nonvacuous generalization bounds for deep (stochastic) neural networks with many more parameters than training data", "authors": ["Gintare Karolina Dziugaite", "Daniel M Roy"], "venue": "arXiv preprint arXiv:1703.11008,", "year": 2017}, {"title": "Regularization networks and support vector machines", "authors": ["Theodoros Evgeniou", "Massimiliano Pontil", "Tomaso Poggio"], "venue": "Advances in computational mathematics,", "year": 2000}, {"title": "A rank minimization heuristic with application to minimum order system approximation", "authors": ["Maryam Fazel", "Haitham Hindi", "Stephen P Boyd"], "venue": "In American Control Conference,", "year": 2001}, {"title": "Sizeindependent sample complexity of neural networks", "authors": ["Noah Golowich", "Alexander Rakhlin", "Ohad Shamir"], "venue": "arXiv preprint arXiv:1712.06541,", "year": 2017}, {"title": "Train faster, generalize better: Stability of stochastic gradient descent", "authors": ["Moritz Hardt", "Benjamin Recht", "Yoram Singer"], "venue": "In ICML,", "year": 2016}, {"title": "Keeping the neural networks simple by minimizing the description length of the weights", "authors": ["Geoffrey E Hinton", "Drew Van Camp"], "venue": "In Proceedings of the sixth annual conference on Computational learning theory,", "year": 1993}, {"title": "Batch normalization: Accelerating deep network training by reducing internal covariate shift", "authors": ["Sergey Ioffe", "Christian Szegedy"], "venue": "In ICML,", "year": 2015}, {"title": "Generalization in deep learning", "authors": ["Kenji Kawaguchi", "Leslie Pack Kaelbling", "Yoshua Bengio"], "venue": "arXiv preprint arXiv:1710.05468,", "year": 2017}, {"title": "Algorithmic stability and sanity-check bounds for leave-one-out cross-validation", "authors": ["Michael Kearns", "Dana Ron"], "venue": "Neural computation,", "year": 1999}, {"title": "On largebatch training for deep learning: Generalization gap and sharp minima", "authors": ["Nitish Shirish Keskar", "Dheevatsa Mudigere", "Jorge Nocedal", "Mikhail Smelyanskiy", "Ping Tak Peter Tang"], "venue": "arXiv preprint arXiv:1609.04836,", "year": 2016}, {"title": "Imagenet classification with deep convolutional neural networks. In Advances in neural information processing", "authors": ["Alex Krizhevsky", "Ilya Sutskever", "Geoffrey E Hinton"], "year": 2012}, {"title": "not) bounding the true error", "authors": ["John Langford", "Rich Caruana"], "venue": "In Proceedings of the 14th International Conference on Neural Information Processing Systems: Natural and Synthetic,", "year": 2001}, {"title": "Fisher-rao metric, geometry, and complexity of neural networks", "authors": ["Tengyuan Liang", "Tomaso Poggio", "Alexander Rakhlin", "James Stokes"], "venue": "arXiv preprint arXiv:1711.01530,", "year": 2017}, {"title": "Relating data compression and learnability", "authors": ["Nick Littlestone", "Manfred Warmuth"], "venue": "Technical report,", "year": 1986}, {"title": "Some PAC-Bayesian theorems", "authors": ["David A McAllester"], "venue": "In Proceedings of the eleventh annual conference on Computational learning theory,", "year": 1998}, {"title": "PAC-Bayesian model averaging", "authors": ["David A McAllester"], "venue": "In Proceedings of the twelfth annual conference on Computational learning theory,", "year": 1999}, {"title": "On the importance of single directions for generalization", "authors": ["Ari Morcos", "David GT Barrett", "Matthew Botvinick", "Neil Rabinowitz"], "venue": "In Proceeding of the International Conference on Learning Representations,", "year": 2018}, {"title": "Path-sgd: Path-normalized optimization in deep neural networks", "authors": ["Behnam Neyshabur", "Ruslan R Salakhutdinov", "Nati Srebro"], "venue": "In Advances in Neural Information Processing Systems,", "year": 2015}, {"title": "Norm-based capacity control in neural networks", "authors": ["Behnam Neyshabur", "Ryota Tomioka", "Nathan Srebro"], "venue": "In Proceeding of the 28th Conference on Learning Theory (COLT),", "year": 2015}, {"title": "In search of the real inductive bias: On the role of implicit regularization in deep learning", "authors": ["Behnam Neyshabur", "Ryota Tomioka", "Nathan Srebro"], "venue": "Proceeding of the International Conference on Learning Representations workshop track,", "year": 2015}, {"title": "A pac-bayesian approach to spectrally-normalized margin bounds for neural networks", "authors": ["Behnam Neyshabur", "Srinadh Bhojanapalli", "David McAllester", "Nathan Srebro"], "venue": "arXiv preprint arXiv:1707.09564,", "year": 2017}, {"title": "Exploring generalization in deep learning", "authors": ["Behnam Neyshabur", "Srinadh Bhojanapalli", "David McAllester", "Nati Srebro"], "venue": "In Advances in Neural Information Processing Systems,", "year": 2017}, {"title": "Hoeffding\u2019s inequality for sums of weakly dependent random variables", "authors": ["Christos Pelekis", "Jan Ramon"], "venue": "arXiv preprint arXiv:1507.06871,", "year": 2015}, {"title": "Learnability, stability and uniform convergence", "authors": ["Shai Shalev-Shwartz", "Ohad Shamir", "Nathan Srebro", "Karthik Sridharan"], "venue": "Journal of Machine Learning Research,", "year": 2010}, {"title": "Very deep convolutional networks for large-scale image recognition", "authors": ["Karen Simonyan", "Andrew Zisserman"], "venue": "arXiv preprint arXiv:1409.1556,", "year": 2014}, {"title": "The connection between regularization operators and support vector kernels", "authors": ["Alex J Smola", "Bernhard Sch\u00f6lkopf", "Klaus-Robert M\u00fcller"], "venue": "Neural networks,", "year": 1998}, {"title": "Dropout: A simple way to prevent neural networks from overfitting", "authors": ["Nitish Srivastava", "Geoffrey Hinton", "Alex Krizhevsky", "Ilya Sutskever", "Ruslan Salakhutdinov"], "venue": "The Journal of Machine Learning Research,", "year": 1929}, {"title": "Understanding deep learning requires rethinking generalization", "authors": ["Chiyuan Zhang", "Samy Bengio", "Moritz Hardt", "Benjamin Recht", "Oriol Vinyals"], "venue": "In International Conference on Learning Representations,", "year": 2017}], "id": "SP:91fce4a9f9ff21088ae6fb542dde4fc374737a95", "authors": [{"name": "Sanjeev Arora", "affiliations": []}, {"name": "Rong Ge", "affiliations": []}, {"name": "Behnam Neyshabur", "affiliations": []}, {"name": "Yi Zhang", "affiliations": []}], "abstractText": "Deep nets generalize well despite having more parameters than the number of training samples. Recent works try to give an explanation using PAC-Bayes and Margin-based analyses, but do not as yet result in sample complexity bounds better than naive parameter counting. The current paper shows generalization bounds that are orders of magnitude better in practice. These rely upon new succinct reparametrizations of the trained net \u2014 a compression that is explicit and efficient. These yield generalization bounds via a simple compression-based framework introduced here. Our results also provide some theoretical justification for widespread empirical success in compressing deep nets. Analysis of correctness of our compression relies upon some newly identified \u201cnoise stability\u201dproperties of trained deep nets, which are also experimentally verified. The study of these properties and resulting generalization bounds are also extended to convolutional nets, which had eluded earlier attempts on proving generalization.", "title": "Stronger Generalization Bounds for Deep Nets via a Compression Approach"}