{"sections": [{"heading": "1. Introduction and Background", "text": "The hierarchical Dirichlet process hidden Markov model (HDP-HMM) (Beal et al., 2001; Teh et al., 2006) is a Bayesian model for time series data that generalizes the conventional hidden Markov Model to allow a countably infinite state space. The hierarchical structure ensures that, despite the infinite state space, a common set of destination states will be reachable with positive probability from each source state. The HDP-HMM can be characterized by the following generative process.\nEach state, indexed by j, has parameters, \u03b8j , drawn from a base measure, H . A top-level sequence of state weights, \u03b2 = (\u03b21, \u03b22, . . . ), is drawn by iteratively break-\n1 Oberlin College, Oberlin, OH, USA 2The University of Arizona, Tucson, AZ, USA. Correspondence to: Colin Reimer Dawson <cdawson@oberlin.edu>.\nProceedings of the 34 th International Conference on Machine Learning, Sydney, Australia, PMLR 70, 2017. Copyright 2017 by the author(s).\ning a \u201cstick\u201d off of the remaining weight according to a Beta (1, \u03b3) distribution. The parameter \u03b3 > 0 is known as the concentration parameter and governs how quickly the weights tend to decay, with large \u03b3 corresponding to slow decay, and hence more weights needed before a given cumulative weight is reached. This stick-breaking process is denoted by GEM (Ewens, 1990; Sethuraman, 1994) for Griffiths, Engen and McCloskey. We thus have a discrete probability measure, G0, with weights \u03b2j at locations \u03b8j , j = 1, 2, . . . , defined by\n\u03b8j i.i.d.\u223c H \u03b2 \u223c GEM(\u03b3). (1)\nG0 drawn in this way is a Dirichlet Process (DP) random measure with concentration \u03b3 and base measure H .\nThe actual transition distribution, \u03c0j , from state j, is drawn from another DP with concentration \u03b1 and base measure G0:\n\u03c0j i.i.d.\u223c DP(\u03b1G0) j = 0, 1, 2, . . . (2)\nwhere \u03c00 represents the initial distribution. The hidden state sequence, z1, z2, . . . zT is then generated according to z1 |\u03c00 \u223c Cat(\u03c00), and\nzt | zt\u22121,\u03c0zt\u22121 \u223c Cat(\u03c0zt\u22121) t = 1, 2, . . . , T (3)\nFinally, the emission distribution for state j is a function of \u03b8j , so that observation yt is drawn according to\nyt | zt, \u03b8zt \u223c F (\u03b8zt) (4)\nA shortcoming of the HDP prior on the transition matrix is that it does not use the fact that the source and destination states are the same set: that is, each \u03c0j has a special element which corresponds to a self-transition. In the HDPHMM, however, self-transitions are no more likely a priori than transitions to any other state. The Sticky HDP-HMM (Fox et al., 2008) addresses this issue by adding an extra mass \u03ba at location j to the base measure of the DP that generates \u03c0j . That is, (2) is replaced by\n\u03c0j \u223c DP(\u03b1G0 + \u03ba\u03b4\u03b8j ). (5)\nAn alternative approach that treats self-transitions as special is the HDP Hidden Semi-Markov Model (HDPHSMM; Johnson & Willsky (2013)), wherein state duration distributions are modeled separately, and ordinary selftransitions are ruled out. However, while both of these\nmodels have the ability to privilege self-transitions, they contain no notion of similarity for pairs of states that are not identical: in both cases, when the transition matrix is integrated out, the prior probability of transitioning to state j\u2032 depends only on the top-level stick weight associated with state j\u2032, and not on the identity or parameters of the previous state j.\nThe two main contributions of this paper are (1) a generalization of the HDP-HMM, which we call the HDP-HMM with local transitions (HDP-HMM-LT) that allows for a geometric structure to be defined on the latent state space, so that \u201cnearby\u201d states are a priori more likely to have transitions between them, and (2) a simple Gibbs sampling algorithm for this model. The \u201cLT\u201d property is introduced by elementwise rescaling and then renormalizing of the HDP transition matrix. Two versions of the similarity structure are illustrated: in one case, two states are similar to the extent that their emission distributions are similar. In another, the similarity structure is inferred separately. In both cases, we give augmented data representations that restore conditional conjugacy and thus allow a simple Gibbs sampling algorithm to be used for inference.\nA rescaling and renormalization approach similar to the one used in the HDP-HMM-LT is used by Paisley et al. (2012) to define their Discrete Infinite Logistic Normal (DILN) model, an instance of a correlated random measure (Ranganath & Blei, 2016), in the setting of topic modeling. There, however, the contexts and the mixture components (topics) are distinct sets, and there is no notion of temporal dependence. Zhu et al. (2016) developed an HMM based directly on the DILN model1. Both Paisley et al. and Zhu et al. employ variational approximations, whereas we present a Gibbs sampler, which converges asymptotically to the true posterior. We discuss additional differences between our model and the DILN-HMM in Sec. 2.2.\nOne class of application in which it is useful to incorporate a notion of locality occurs when the latent state sequence consists of several parallel chains, so that the global state changes incrementally, but where these increments are not independent across chains. Factorial HMMs (Ghahramani et al., 1997) are commonly used in this setting, but this ignores dependence among chains, and hence may do poorly when some combinations of states are much more probable than suggested by the chain-wise dynamics.\nAnother setting where the LT property is useful is when there is a notion of state geometry that licenses syllogisms: e.g., if A frequently leads to B and C and B frequently leads to D and E, then it may be sensible to infer that A and C may lead to D and E as well. This property is arguably\n1We thank an anonymous ICML reviewer for bringing this paper to our attention.\npresent in musical harmony, where consecutive chords are often (near-)neighbors in the \u201ccircle of fifths\u201d, and small steps along the circle are more common than large ones.\nThe paper is structured as follows: In section 2 we define the model. In section 3, we develop a Gibbs sampling algorithm based on an augmented data representation, which we call the Markov Jump Process with Failed Transitions (MJP-FT). In section 4 we test two versions of the model: one on a speaker diarization task in which the speakers are inter-dependent, and another on a fourpart chorale corpus, demonstrating performance improvements over state-of-the-art models when \u201clocal transitions\u201d are more common in the data. Using sythetic data from an HDP-HMM, we show that the LT variant can learn not to use its similarity bias when the data does not support it. Finally, in section 5, we conclude and discuss the relationships between the HDP-HMM-LT and existing HMM variants. Code and additional details are available at http://colindawson.net/hdp-hmm-lt/"}, {"heading": "2. An HDP-HMM With Local Transitions", "text": "We wish to add to the transition model the concept of a transition to a \u201cnearby\u201d state, where transitions between states j and j\u2032 are more likely a priori to the extent that they are \u201cnearby\u201d in some similarity space. In order to accomplish this, we first consider an alternative construction of the transition distributions, based on the Normalized Gamma Process representation of the DP (Ishwaran & Zarepour, 2002; Ferguson, 1973)."}, {"heading": "2.1. A Normalized Gamma Process representation of the HDP-HMM", "text": "The Dirichlet Process is an instance of a normalized completely random measure (Kingman, 1967; Ferguson, 1973), that can be defined as G = \u2211\u221e k=1 \u03c0\u0303k\u03b4\u03b8k , where\n\u03c0k ind.\u223c Gamma(\u03b1\u03b2k, 1) T = \u221e\u2211 k=1 \u03c0k \u03c0\u0303k = \u03c0k T , (6)\n\u03b4\u03b8 is a measure assigning 1 to sets if they contain \u03b8 and 0 otherwise, and subject to the constraint that \u2211 k\u22651 \u03b2k = 1 and 0 < \u03b1 <\u221e. It has been shown (Ferguson, 1973; Paisley et al., 2012; Favaro et al., 2013) that the normalization constant T is positive and finite almost surely, and thatG is distributed as a DP with base measure G0 = \u2211\u221e k=1 \u03b2k\u03b4\u03b8k . If we draw \u03b2 = (\u03b21, \u03b22, . . . ) from the GEM(\u03b3) stickbreaking process, draw an i.i.d. sequence of \u03b8k from a base measure H , and then draw an i.i.d. sequence of random measures, {Gj}, j = 1, 2, . . . , from the above process, this defines a Hierarchical Dirichlet Process (HDP). If each Gj is associated with the hidden states of an HMM, \u03c0 is the infinite matrix where entry \u03c0jj\u2032 is the j\u2032th mass associated\nwith the jth random measure, and Tj is the sum of row j, then we obtain the prior for the HDP-HMM, where\np(zt | zt\u22121,\u03c0) = \u03c0\u0303zt\u22121zt = \u03c0jj\u2032/Tj (7)"}, {"heading": "2.2. Promoting \u201cLocal\u201d Transitions", "text": "In the HDP prior, the rows of the transition matrix are conditionally independent. We wish to relax this assumption, to incorporate possible prior knowledge that certain pairs of states are \u201cnearby\u201d in some sense and thus more likely than others to produce large transition weights between them (in both directions); that is, transitions are likely to be \u201clocal\u201d. We accomplish this by associating each latent state j with a location `j in some space \u2126, introducing a \u201csimilarity function\u201d \u03c6 : \u2126 \u00d7 \u2126 \u2192 (0, 1], and scaling each element \u03c0jj\u2032 by \u03c6jj\u2032 = \u03c6(`j , `j\u2032). For example, we might wish to define a (possibly asymmetric) divergence function d : \u2126\u00d7 \u2126\u2192 [0,\u221e) and set \u03c6(`j , `j) = exp{\u2212d(`j , `j\u2032)} so that transitions are less likely the farther apart two states are. By setting \u03c6 \u2261 1, we obtain the standard HDP-HMM. The DILN-HMM (Zhu et al., 2016), employs a similar rescaling of transition probabilities via an exponentiated Gaussian Process, following (Paisley et al., 2012), but the scaling function must be positive semi-definite, and in particular symmetric, whereas in the HDP-HMM-LT, \u03c6 need only take values in (0, 1]. Moreover, the DILN-HMM does not allow the scales to be tied to other state parameters, and hence encode an independent notion of similarity.\nLetting ` = (`1, `2, . . . ), we can replace (6) for j \u2265 1 by\n\u03c0jj\u2032 |\u03b2, ` \u223c Gamma(\u03b1\u03b2j\u2032 , 1), Tj = \u221e\u2211 j\u2032=1 \u03c0jj\u2032\u03c6jj\u2032\n\u03c0\u0303jj\u2032 = \u03c0jj\u2032\u03c6jj\u2032/Tj , p(zt | zt\u22121,\u03c0, `) = \u03c0\u0303zt\u22121zt .\n(8)\nSince the \u03c6jj\u2032 are positive and bounded above by 1, 0 < \u03c0j1\u03c6j1 \u2264 Tj \u2264 \u2211 j\u2032 \u03c0jj\u2032 <\u221e (9)\nalmost surely, where the last inequality carries over from the original HDP. The prior means of the unnormalized transition distributions, \u03c0j are then proportional (for each j) to \u03b1\u03b2\u03c6j where \u03c6j = (\u03c6j1, \u03c6j2, . . . ).\nThe distribution of the latent state sequence z given \u03c0 and ` is now\np(z |\u03c0, `) = T\u220f t=1 \u03c0zt\u22121zt\u03c6zt\u22121ztT \u2212nzt\u22121\u00b7 zt\u22121\n= \u221e\u220f j=1 T\u22121j \u221e\u220f j\u2032=1 \u03c0 njj\u2032 jj\u2032 \u03c6 njj\u2032 jj\u2032\n(10)\nwhere njj\u2032 = \u2211T t=1 I(zt\u22121 = j, zt = j\n\u2032) is the number of transitions from state j to state j\u2032 in the sequence z\nand nj\u00b7 = \u2211 j\u2032 njj\u2032 is the total number of visits to state j. Since Tj is a sum over products of \u03c0jj\u2032 and \u03c6jj\u2032 terms, the posterior for \u03c0 is no longer a DP. However, conditional conjugacy can be restored by a data-augmentation process with a natural interpretation, which is described next."}, {"heading": "2.3. The HDP-HMM-LT as the Marginalization of a Markov Jump Process with \u201cFailed\u201d Transitions", "text": "In this section, we define a stochastic process that we call the Markov Jump Process with Failed Transitions (MJP-FT), from which we obtain the HDP-HMM-LT by marginalizing over some of the variables. By reinstating these auxiliary variables, we obtain a simple Gibbs sampling algorithm over the full MJP-FT, which can be used to sample from the marginal posterior of the variables used by the HDP-HMM-LT.\nLet \u03b2, \u03c0, ` and Tj , j = 1, 2, . . . be defined as in the last section. Consider a continuous-time Markov Process over the states j = 1, 2, . . . , and suppose that if the process makes a jump to state zt at time \u03c4t, the next jump, which is to state zt+1, occurs at time \u03c4t + u\u0303t, where u\u0303t \u223c Exp( \u2211 j\u2032 \u03c0jj\u2032), and p(zt+1 = j\n\u2032 | zt = j) \u221d \u03c0jj\u2032 , independent of u\u0303t. Note that in this formulation, unlike in standard formulations of Markov Jump Processes, we are assuming that self-jumps are possible.\nIf we only observe the jump sequence z and not the holding times u\u0303t, this is an ordinary Markov chain with transition matrix row-proportional to \u03c0. If we do not observe the jumps directly, but instead an observation is generated once per jump from a distribution that depends on the state being jumped to, then we have an ordinary HMM whose transition matrix is obtained by normalizing \u03c0; that is, we have the HDP-HMM.\nWe modify this process as follows. Suppose each jump attempt from state j to state j\u2032 has probability (1 \u2212 \u03c6jj\u2032) of failing, in which case no transition occurs and no observation is generated. Assuming independent failures, the rates of successful and failed jumps from j to j\u2032 are \u03c0jj\u2032\u03c6jj\u2032 and \u03c0jj\u2032(1 \u2212 \u03c6jj\u2032), respectively. The probability that the first successful jump is to state j\u2032 (that is, that zt+1 = j\u2032) is proportional to the rate of successful jump attempts to j\u2032, which is \u03c0jj\u2032\u03c6jj\u2032 . Conditioned on zt, the holding time, u\u0303t, is independent of zt+1 and is distributed as Exp(Tzt). We denote the total time spent in state j by uj = \u2211 t:zt=j\nu\u0303t, where, as the sum of i.i.d. Exponentials,\nuj | z,\u03c0,\u03b8 ind.\u223c Gamma(nj\u00b7, Tj) (11)\nDuring this period there will be qjj\u2032 failed attempts to jump to state j\u2032, where qjj\u2032 \u223c Poisson(uj\u03c0jj\u2032(1\u2212 \u03c6jj\u2032)) are independent. This data augmentation bears some conceptual similarity to the Geometrically distributed \u03c1 auxiliary variables introduced to the HDP-HSMM (Johnson & Willsky,\n2013) to restore conditional conjugacy. However, there are key differences: first, \u03c1 measure how many steps the chain would have remained in state j under Markovian dynamics, whereas our u represents putative continuous holding times between each transition, and second \u03c1 allows for the restoration of a zeroed out entry in each row, whereas u allows us to work with unnormalized \u03c0 entries, avoiding the need to restore zeroed out entries in the HSMM-LT\nIncorporating u = {uj} and Q = {qjj\u2032} as augmented data simplifies the likelihood for \u03c0, yielding\np(z,u,Q |\u03c0) = p(z |\u03c0)p(u | z,\u03c0)p(Q |u,\u03c0) (12)\nwhere dependence on ` has been omitted for conciseness. After grouping terms and omitting terms that do not depend on \u03c0, this proportional (as a function of \u03c0) to\u220f\nj \u220f j\u2032 \u03c0 njj\u2032+qjj\u2032 jj\u2032 \u03c6 njj\u2032 jj\u2032 (1\u2212 \u03c6jj\u2032) qjj\u2032 e\u2212\u03c0jj\u2032uj (13)\nConveniently, the Tj have canceled, and the exponential terms involving \u03c0jj\u2032 and \u03c6jj\u2032 in the Gamma and Poisson distributions of uj and qjj\u2032 combine to cause \u03c6jj\u2032 to vanish."}, {"heading": "2.4. Sticky and Semi-Markov Generalizations", "text": "We note that the local transition property of the HDPHMM-LT can be combined with the Sticky property of the Sticky HDP-HMM (Fox et al., 2008), or the nongeometric duration distributions of the HDP-HSMM (Johnson & Willsky, 2013), to add additional prior weight on self-transitions. In the former case, no changes to inference are needed; one can simply add the the extra mass \u03ba to the shape parameter of the Gamma prior on the \u03c0jj , and employ the same auxiliary variable method used by Fox et al. to distinguish \u201cSticky\u201d from \u201cregular\u201d self-transitions. For the semi-Markov case, we can fix the diagonal elements of \u03c0 to zero, and allow Dt observations to be emitted i.i.d. according to a state-specific duration distribution, and sample the latent state sequence using a suitable semi-Markov message passing algorithm (Johnson & Willsky, 2013). Inference for the \u03c6 matrix is not affected, since the diagonal elements are assumed to be 1. Unlike in the original representation of the HDP-HSMM, no further dataaugmentation is needed, as the (continuous) durations u already account for the normalization of the \u03c0."}, {"heading": "2.5. Obtaining the Factorial HMM as a Limiting Case", "text": "One setting in which a local transition property is desirable is the case where the latent states encode multiple hidden features at time t as a vector of categories. Such problems are often modeled using factorial HMMs (Ghahramani et al., 1997). In fact, the HDP-HMM-LT yields the factorial HMM in the limit as \u03b1, \u03b3 \u2192\u221e, fixing each row of \u03c0 to be\nuniform with probability 1, so the dynamics are controlled entirely by \u03c6. If A(d) is the transition matrix for chain d, then setting \u03c6(`j , `j\u2032) = exp\u2212d(`j , `j\u2032) with asymmetric \u201cdivergences\u201d d(`j , `j\u2032) = \u2212 \u2211 d log(A (d) `jd,`j\u2032d\n) yields the factorial transition model."}, {"heading": "2.6. An Infinite Factorial HDP-HMM-LT", "text": "Nonparametric extensions of the factorial HMM, such as the infinite factorial hidden Markov Model (Gael et al., 2009) and the infinite factorial dynamic model (Valera et al., 2015), have been developed in recent years by making use of the Indian Buffet Process (Ghahramani & Griffiths, 2005) as a state prior. It would be conceptually straightforward to combine the IBP state prior with the similarity bias of the LT model, provided the chosen similarity function is uniformly bounded above on the space of infinite length binary vectors (for example, take \u03c6(u, v) to be the exponentiated negative Hamming distance between u and v). Since the number of differences between two draws from the IBP is finite with probability 1, this yields a reasonable similarity metric."}, {"heading": "3. Inference", "text": "We develop a Gibbs sampling algorithm based on the MJPFT representation described in Sec. 2.3, augmenting the data with the duration variables u, the failed jump attempt count matrix, Q, as well as additional auxiliary variables which we will define below. In this representation the transition matrix is not represented directly, but is a deterministic function of the unscaled transition \u201crate\u201d matrix, \u03c0, and the similarity matrix, \u03c6. The full set of variables is partitioned into blocks: {\u03b3, \u03b1, \u03b2,\u03c0}, {z,u,Q,\u039b}, {\u03b8, `}, and {\u03be}, where \u039b represents a set of auxiliary variables that will be introduced below, \u03b8 represents the emission parameters (which may be further blocked depending on the specific choice of model), and \u03be represents additional parameters such as any free parameters of the similarity function, \u03c6, and any hyperparameters of the emission distribution."}, {"heading": "3.1. Sampling Transition Parameters and Hyperparameters", "text": "The joint posterior over \u03b3, \u03b1, \u03b2 and \u03c0 given the augmented data D = (z,u,Q,\u039b) will factor as\np(\u03b3,\u03b1,\u03b2,\u03c0 | D) = p(\u03b3 | D)p(\u03b1 | D)p(\u03b2 | \u03b3,D)p(\u03c0 |\u03b1, \u03b2,D) (14)\nWe describe these four factors in reverse order.\nSampling \u03c0 Having used data augmentation to simplify the likelihood for \u03c0 to the factored conjugate form in (13), the individual \u03c0jj\u2032 are a posteriori independent\nGamma(\u03b1\u03b2j\u2032 + njj\u2032 + qjj\u2032 , 1 + uj) distributed.\nSampling \u03b2 To enable joint sampling of z, we employ a weak limit approximation to the HDP (Johnson & Willsky, 2013), approximating the stick-breaking process for \u03b2 using a finite Dirichlet distribution with a J components, where J is larger than we expect to need. Due to the product-of-Gammas form, we can integrate out \u03c0 analytically to obtain the marginal likelihood:\np(\u03b2 | \u03b3) = \u0393(\u03b3/J) J\n\u0393(\u03b3) \u220f j \u03b2 \u03b3 J\u22121 j (15)\np(D |\u03b2, \u03b1) \u221d J\u220f j=1 (1 + uj) \u2212\u03b1 \u220f j\u2032 \u0393(\u03b1\u03b2j\u2032 + njj\u2032 + qjj\u2032) \u0393(\u03b1\u03b2j\u2032)\nwhere we have used the fact that the \u03b2j sum to 1 to pull out terms of the form (1 + uj)\u2212\u03b1\u03b2j\u2032 from the inner product in the likelihood. Following Teh et al. (2006), we can introduce auxiliary variables M = {mjj\u2032}, with\np(mjj\u2032 |\u03b2j\u2032 , \u03b1,D) ind\u221d snjj\u2032+qjj\u2032 ,mjj\u2032\u03b1 mjj\u2032\u03b2 mjj\u2032 j\u2032 (16)\nfor integer mjj\u2032 ranging between 0 and njj\u2032 + qjj\u2032 , where sn,m is an unsigned Stirling number of the first kind. The normalizing constant in this distribution cancels the ratio of Gamma functions in the \u03b2 likelihood, so, letting m\u00b7j\u2032 = \u2211 jmjj\u2032 and m\u00b7\u00b7 = \u2211 j\u2032 m\u00b7j\u2032 , the posterior for (the truncated) \u03b2 is a Dirichlet whose jth mass parameter is \u03b3J +m\u00b7j .\nSampling Concentration Parameters Incorporating M into D, we can integrate out \u03b2 to obtain\np(D |\u03b1, \u03b3) \u221d \u03b1m\u00b7\u00b7e\u2212 \u2211 j\u2032\u2032 log(1+uj\u2032\u2032 )\u03b1\n\u0393(\u03b3) \u0393(\u03b3 +m\u00b7\u00b7) \u00d7 \u220f j \u0393( \u03b3J +m\u00b7j) \u0393( \u03b3J )\n(17)\nAssuming that \u03b1 and \u03b3 have Gamma priors with shape and rate parameters a\u03b1, b\u03b1 and a\u03b3 , b\u03b3 , then\n\u03b1 | D \u223c Gamma(a\u03b1 +m\u00b7\u00b7, b\u03b1 + \u2211 j log(1 + uj)). (18)\nTo simplify the likelihood for \u03b3, we can introduce a final set of auxiliary variables, r = (r1, . . . , rJ), rj\u2032 \u2208 {0, . . . ,m\u00b7j\u2032} and w \u2208 (0, 1) with the following distributions:\np(rj\u2032 = r |m\u00b7j\u2032 , \u03b3) \u221d s(m\u00b7j\u2032 , r) ( \u03b3 J )r (19) p(w |m\u00b7\u00b7\u03b3) \u221d w\u03b3\u22121(1\u2212 w)m\u00b7\u00b7\u22121 (20)\nThe normalizing constants are ratios of Gamma functions, which cancel those in (17), so that\n\u03b3 | D, r, w \u223c Gamma(a\u03b3 + r\u00b7, b\u03b3 \u2212 log(w)) (21)"}, {"heading": "3.2. Sampling z and the auxiliary variables", "text": "We sample the hidden state sequence, z, jointly with the auxiliary variables, which consist of u, Q, M, r and w. The joint conditional distribution of these variables is defined directly by the generative model:\np(D) = p(z)p(u | z)p(Q |u)p(M | z,Q)p(r |M)p(w |M)\nSince we are conditioning on the transition matrix, we can sample the entire sequence z jointly with the forwardbackward algorithm, as in an ordinary HMM. Since we are sampling the labels jointly, this step requiresO(TJ2) computation per iteration, which is the bottleneck of the inference algorithm for reasonably large T or J (other updates are constant in T or in J). Having done this, we can sample u, Q, M, r andw from their forward distributions. It is also possible to employ a variant on beam sampling (Van Gael et al., 2008) to speed up each iteration, at the cost of slower mixing, but we did not use this variant here."}, {"heading": "3.3. Sampling state and emission parameters", "text": "Depending on the application, the locations ` may or may not depend on the emission parameters, \u03b8. If not, sampling \u03b8 conditional on z is unchanged from the HDP-HMM. There is no general-purpose method for sampling `, or for sampling \u03b8 in the dependent case, due to the dependence on the form of \u03c6 and on the emission model, but specific instances are illustrated in the experiments below."}, {"heading": "4. Experiments", "text": "The parameter space for the hidden states, the associated prior H on \u03b8, and the similarity function \u03c6, is applicationspecific; we consider here two cases. The first is a speakerdiarization task, where each state consists of a finite Ddimensional binary vector whose entries indicate which speakers are currently speaking. In this experiment, the state vectors both determine the pairwise similarities and partially determine the emission distributions via a linearGaussian model. In the second experiment, the data consists of Bach chorales, and the latent states can be thought of as harmonic contexts. There, the components of the states that govern similarities are modeled as independent of the emission distributions, which are categorical distributions over four-voice chords."}, {"heading": "4.1. Cocktail Party", "text": "The Data The data was constructed using audio signals collected from the PASCAL 1st Speech Separation Challenge2. The underlying signal consisted ofD = 16 speaker channels recorded at each of T = 2000 time steps, with the\n2 http://laslab.org/SpeechSeparationChallenge/\nresulting T \u00d7 D signal matrix, denoted by \u03b8\u2217, mapped to K = 12 microphone channels via a weight matrix, W. The 16 speakers were grouped into 4 conversational groups of 4, where speakers within a conversation took turns speaking (see Fig. 2). In such a task, there are naively 2D possible states (here, 65536). However, due to the conversational grouping, if at most one speaker in a conversation is speaking at any given time, the state space is constrained, with only \u220f c(sc + 1) states possible, where sc is the number of speakers in conversation c (in this case sc \u2261 4, for a total of 625 possible states).\nEach \u201cturn\u201d within a conversation consisted of a single sentence (average duration \u223c 3s) and turn orders within a conversation were randomly generated, with random pauses distributed as N (1/4s, (1/4s)2) inserted between sentences. Every time a speaker has a turn, the sentence is drawn randomly from the 500 sentences uttered by that speaker in the data. The conversations continued for 40s, and the signal was down-sampled to length 2000. The \u2019on\u2019 portions of each speaker\u2019s signal were normalized to have amplitudes with mean 1 and standard deviation 0.5. An additional column of 1s was added to the speaker signal matrix, \u03b8\u2217, representing background noise. The resulting signal matrix, denoted \u03b8\u2217, was thus 2000\u00d7 17 and the weight matrix, W, was 17\u00d7 12. Following Gael et al. (2009) and Valera et al. (2015), the weights were drawn independently from a Unif(0, 1) distribution, and independentN (0, 0.32) noise was added to each entry of the observation matrix.\nThe Model The latent states, \u03b8j , are the D-dimensional binary vectors whose dth entry indicates whether or not speaker d is speaking. The locations `j are identified with the binary vectors, `j := \u03b8j . We use a Laplacian similarity function on Hamming distance, d0, so that \u03c6jj\u2032 := exp(\u2212\u03bbd0(`j , `j\u2032)), \u03bb \u2265 0. The emission model is linearGaussian as in the data, with (D + 1) \u00d7K weight matrix W, and T \u00d7 (D + 1) signal matrix \u03b8\u2217 whose tth row is \u03b8t := (1,\u03b8zt), so that yt | z \u223c N (WT\u03b8 \u2217 t ,\u03a3). For the experiments discussed here, we assume that \u03a3 is independent of j, but this assumption is easily relaxed if appropriate.\nFor finite-length binary vector states, the set of possible states is finite, and so it may seem that a nonparametric model is unnecessary. However, if D is reasonably large, likely most of the 2D possible states are vanishingly unlikely (and the number of observations may well be less than 2D), and so we would like to encourage the selection of a sparse set of states. Moreover, there could be more than one state with the same emission parameters, but with different transition dynamics. Next we describe the additional inference steps needed for this version of the model.\nSampling \u03b8 / ` Since \u03b8j and `j are identified, influencing both the transition matrix and the emission distributions,\nboth the state sequence z and the observation matrix Y are used in the update. We put independent Beta-Bernoulli priors on each coordinate of \u03b8, and Gibbs sample each coordinate \u03b8jd conditioned on all the others and the coordinatewise prior means, {\u00b5d}, which we sample in turn conditioned on \u03b8. Details are in the supplement.\nSampling \u03bb The \u03bb parameter of the similarity function governs the connection between ` and \u03c6. Substituting the definition of \u03c6 into (13) yields\np(z,Q | `, \u03bb) \u221d \u220f j \u220f j\u2032 e\u2212\u03bbdjj\u2032njj\u2032 (1\u2212 e\u2212\u03bbdjj\u2032 )qjj\u2032 (22)\nWe put an Exp(b\u03bb) prior on \u03bb, which yields a posterior density\np(\u03bb | z,Q, `) \u221d e\u2212(b\u03bb+ \u2211 j \u2211 j\u2032 djj\u2032njj\u2032 )\u03bb (23)\n\u00d7 \u220f j \u220f j\u2032 (1\u2212 e\u2212\u03bbdjj\u2032 )qjj\u2032\nThis density is log-concave, and so we use Adaptive Rejection Sampling (Gilks & Wild, 1992) to sample from it.\nSampling W and \u03a3 Conditioned on Y and \u03b8\u2217, W and \u03a3 can be sampled as in Bayesian linear regression. If each column of W has a multivariate Normal prior, then the columns are a posteriori independent multivariate Normals. For the experiments reported here, we fix W to its ground truth value so that \u03b8\u2217 can be compared directly with the ground truth signal matrix, and we constrain \u03a3 to be diagonal, with Inverse Gamma priors on the variances, resulting in conjugate updates.\nResults We attempted to infer the binary speaker matrices using five models: (1) a binary-state Factorial HMM (Ghahramani et al., 1997), where individual binary speaker sequences are modeled as independent, (2) an ordinary HDP-HMM without local transitions (Teh et al., 2006), where the latent states are binary vectors, (3) a Sticky HDPHMM (Fox et al., 2008), (4) our HDP-HMM-LT model, and (5) a model that combines the Sticky and LT properties3. For all models, all concentration and noise precision parameters are given Gamma(0.1, 0.1) priors. For the Sticky models, the ratio \u03ba\u03b1+\u03ba is given a Unif(0, 1) prior. We evaluated the models at each iteration using both the Hamming distance between inferred and ground truth state matrices and F1 score. We also plot the inferred decay rate \u03bb, and the number of states used by the LT and Sticky-LT models. The results for the five models are in Fig. 1. In\n3We attempted to add a comparison to the DILN-HMM (Zhu et al., 2016) as well, but code could not be obtained, and the paper did not provide enough detail to reproduce their inference algorithm.\nFig. 2, we plot the ground truth state matrix against the average state matrix, \u03b7\u2217, averaged over runs and post-burn-in iterations.\nThe LT and Sticky-LT models outperform the others, while the regular Sticky model exhibits only a small advantage over the vanilla HDP-HMM. Both converge on a nonnegligible \u03bb value of about 1.6 (see Fig. 1), suggesting that the local transition structure explains the data well. The LT models also use more states than the non-LT models, perhaps owing to the fact that the weaker transition prior of the non-LT model is more likely to explain nearby similar observations as a single persisting state, whereas the LT model places a higher probability on transitioning to a new state with a similar latent vector."}, {"heading": "4.2. Synthetic Data Without Local Transitions", "text": "We generated data directly from the ordinary HDP-HMM used in the cocktail experiment as a sanity check, to examine the performance of the LT model in the absence of a similarity bias. The results are in Fig. 3. When the \u03bb parameter is large, the LT model has worse performance than the non-LT model on this data; however, the \u03bb parameter settles near zero as the model learns that local transitions are not more probable. When \u03bb = 0, the HDP-HMM-LT is an ordinary HDP-HMM. The LT model does not make entirely the same inferences as the non-LT model, however; in particular, the \u03b1 concentration parameter is larger. To some extent, \u03b1 and \u03bb trade off: sparsity of the transition matrix can be achieved either by beginning with a sparse rate matrix prior to rescaling (\u03b1 small), or by beginning with a less sparse rate matrix which becomes sparser through rescaling\n(larger \u03b1 and non-zero \u03bb)."}, {"heading": "4.3. Bach Chorales", "text": "To test a version of the HDP-HMM-LT model in which the components of the latent state governing similarity are unrelated to the emission distributions, we used our model to do unsupervised \u201cgrammar\u201d learning from a corpus of Bach chorales. The data was a corpus of 217 four-voice major key chorales by J.S. Bach from music214, 200 of which were randomly selected as a training set, with the other 17 used as a test set to evaluate surprisal (marginal log likelihood per observation) by the trained models. All chorales were transposed to C-major, and each distinct four-voice chord (with voices ordered) was encoded as a single integer. In total there were 3307 distinct chord types and 20401 chord tokens in the 217 chorales, with 3165 types and 18818 tokens in the 200 training chorales, and 143 chord types that were unique to the test set.\nModifications to Model and Inference Since the chords were encoded as integers, the emission distribution for each state is Cat(\u03b8j). We use a symmetric Dirichlet prior for each \u03b8j , resulting in conjugate updates to \u03b8 conditioned on the latent state sequence, z.\nIn this experiment, the locations, `j , are independent of the \u03b8j , withN (0, I) priors. We use a Gaussian similarity function, \u03c6jj := exp{\u2212\u03bbd2(`j , `j\u2032)2} where d2 is Euclidean distance. Since the latent states are continuous, we use\n4 http://web.mit.edu/music21\na Hamiltonian Monte Carlo (HMC) update (Duane et al., 1987; Neal et al., 2011) to update the `j simultaneously, conditioned on z and \u03c0 (see the supplement for details).\nResults We ran 5 Gibbs chains for 10,000 iterations each using the HDP-HMM-LT, Sticky-HDP-HMM-LT, HDPHMM and Sticky-HDP-HMM models on the 200 training chorales, which were modeled as conditionally independent of one another. We evaluated the marginal log likelihood on the 17 test chorales (integrating out z) at every 50th iteration. The training and test log likelihoods are in Fig. 4. Although the LT model does not achieve as close a fit to the training data, its generalization performance is better, suggesting that the vanilla HDP-HMM is overfitting. This is perhaps counterintuitive, since the LT model is more flexible, and might be expected to be more prone to overfitting. However, the similarity bias induces greater information sharing across parameters, as in a hierarchical model: instead of each entry of the transition matrix being informed mainly by transitions directly involving the corresponding states, it is informed to some extent by all transitions, as they all inform the similarity structure."}, {"heading": "5. Discussion", "text": "We have defined a new probabilistic model, the Hierarchical Dirichlet Process Hidden Markov Model with Local Transitions (HDP-HMM-LT), which generalizes the HDP-HMM by allowing state space geometry to be represented via a similarity kernel, making transitions between \u201cnearby\u201d pairs of states (\u201clocal\u201d transitions), more likely a priori. By introducing an augmented data representation,\nwhich we call the Markov Jump Process with Failed Transitions (MJP-FT), we obtain a Gibbs sampling algorithm that simplifies inference in both the LT and ordinary HDPHMM. When multiple latent chains are interdependent, as in speaker diarization, the HDP-HMM-LT model combines the HDP-HMM\u2019s capacity to discover a small set of joint states with the Factorial HMM\u2019s ability to encode the property that most transitions involve a small number of chains. The HDP-HMM-LT outperforms both, as well as outperforming the Sticky-HDP-HMM, on a speaker diarization task in which speakers form conversational groups. Despite the addition of the similarity kernel, the HDP-HMM-LT is able to suppress its local transition prior when the data does not support it, achieving identical performance to the HDPHMM on data generated directly from the latter.\nThe local transition property is particularly clear when transitions occur at different times for different latent features, as with binary vector-valued states in the cocktail party setting, but the model can be used with any state space equipped with a suitable similarity kernel. Similarities need not be defined in terms of emission parameters; state \u201clocations\u201d can be represented and inferred separately, which we demonstrate using Bach chorale data. There, the LT model achieves better predictive performance on a held-out test set, while the ordinary HDP-HMM overfits the training set: the LT property here acts to encourage a concise harmonic representation where chord contexts are arranged in bidirectional functional relationships.\nWe focused on fixed-dimension binary vectors for the cocktail party and synthetic data experiments, but it would be straightforward to add the LT property to a model with nonparametric latent states, such as the iFHMM (Gael et al., 2009) and the infinite factorial dynamic model (Valera et al., 2015), both of which use the Indian Buffet Process (IBP) (Ghahramani & Griffiths, 2005) as a state prior. The similarity function used here could be employed without changes: since only finitely many coordinates are non-zero in the IBP, the distance between any two states is finite."}, {"heading": "ACKNOWLEDGMENTS", "text": "This work was funded in part by DARPA grant W911NF14-1-0395 under the Big Mechanism Program and DARPA grant W911NF-16-1-0567 under the Communicating with Computers Program."}], "year": 2017, "references": [{"title": "The infinite hidden Markov model", "authors": ["Beal", "Matthew J", "Ghahramani", "Zoubin", "Rasmussen", "Carl E"], "venue": "In Advances in neural information processing systems,", "year": 2001}, {"title": "Hybrid monte carlo", "authors": ["Duane", "Simon", "Kennedy", "Anthony D", "Pendleton", "Brian J", "Roweth", "Duncan"], "venue": "Physics letters B,", "year": 1987}, {"title": "Population genetics theory \u2013 the past and the future", "authors": ["Ewens", "Warren John"], "venue": "In Mathematical and Statistical Developments of Evolutionary Theory,", "year": 1990}, {"title": "MCMC for normalized random measure mixture models", "authors": ["Favaro", "Stefano", "Teh", "Yee Whye"], "venue": "Statistical Science,", "year": 2013}, {"title": "A Bayesian analysis of some nonparametric problems", "authors": ["Ferguson", "Thomas S"], "venue": "The annals of statistics,", "year": 1973}, {"title": "An HDP-HMM for systems with state persistence", "authors": ["Fox", "Emily B", "Sudderth", "Erik B", "Jordan", "Michael I", "Willsky", "Alan S"], "venue": "In Proceedings of the 25th international conference on Machine learning,", "year": 2008}, {"title": "The infinite factorial hidden Markov model", "authors": ["Gael", "Jurgen V", "Teh", "Yee W", "Ghahramani", "Zoubin"], "venue": "In Advances in Neural Information Processing Systems,", "year": 2009}, {"title": "Infinite latent feature models and the Indian buffet process", "authors": ["Ghahramani", "Zoubin", "Griffiths", "Thomas L"], "venue": "In Advances in neural information processing systems,", "year": 2005}, {"title": "Factorial hidden Markov models", "authors": ["Ghahramani", "Zoubin", "Jordan", "Michael I", "Smyth", "Padhraic"], "venue": "Machine learning,", "year": 1997}, {"title": "Adaptive rejection sampling for Gibbs sampling", "authors": ["Gilks", "Walter R", "Wild", "Pascal"], "venue": "Applied Statistics,", "year": 1992}, {"title": "Exact and approximate sum representations for the Dirichlet process", "authors": ["Ishwaran", "Hemant", "Zarepour", "Mahmoud"], "venue": "Canadian Journal of Statistics,", "year": 2002}, {"title": "Bayesian nonparametric hidden semi-Markov models", "authors": ["Johnson", "Matthew J", "Willsky", "Alan S"], "venue": "The Journal of Machine Learning Research,", "year": 2013}, {"title": "Completely random measures", "authors": ["Kingman", "John"], "venue": "Pacific Journal of Mathematics,", "year": 1967}, {"title": "MCMC using Hamiltonian dynamics", "authors": ["Neal", "Radford M"], "venue": "Handbook of Markov Chain Monte Carlo,", "year": 2011}, {"title": "The discrete infinite logistic normal distribution", "authors": ["Paisley", "John", "Wang", "Chong", "Blei", "David M"], "venue": "Bayesian Analysis,", "year": 2012}, {"title": "Correlated random measures", "authors": ["Ranganath", "Rajesh", "Blei", "David M"], "venue": "Journal of the American Statistical Association,", "year": 2016}, {"title": "A constructive definition of Dirichlet processes", "authors": ["Sethuraman", "Jayaram"], "venue": "Statistica Sinica,", "year": 1994}, {"title": "Hierarchical Dirichlet processes", "authors": ["Teh", "Yee Whye", "Jordan", "Michael I", "Beal", "Matthew J", "Blei", "David M"], "venue": "Journal of the American Statistical Association,", "year": 2006}, {"title": "Infinite factorial dynamical model", "authors": ["Valera", "Isabel", "Ruiz", "Francisco", "Svensson", "Lennart", "Perez-Cruz", "Fernando"], "venue": "In Advances in Neural Information Processing Systems,", "year": 2015}, {"title": "Beam sampling for the infinite hidden Markov model", "authors": ["Van Gael", "Jurgen", "Saatci", "Yunus", "Teh", "Yee Whye", "Ghahramani", "Zoubin"], "venue": "In Proceedings of the 25th International Conference on Machine Learning,", "year": 2008}, {"title": "Hidden Markov models with discrete infinite logistic normal distribution priors", "authors": ["Zhu", "Hao", "Hu", "Jinsong", "Leung", "Henry"], "venue": "In Information Fusion (FUSION),", "year": 2016}], "id": "SP:99e69c0554c7389e311fd0d60ea0b99e2d4a3713", "authors": [{"name": "Colin Reimer Dawson", "affiliations": []}, {"name": "Chaofan Huang", "affiliations": []}, {"name": "Clayton T. Morrison", "affiliations": []}], "abstractText": "We describe a generalization of the Hierarchical Dirichlet Process Hidden Markov Model (HDPHMM) which is able to encode prior information that state transitions are more likely between \u201cnearby\u201d states. This is accomplished by defining a similarity function on the state space and scaling transition probabilities by pairwise similarities, thereby inducing correlations among the transition distributions. We present an augmented data representation of the model as a Markov Jump Process in which: (1) some jump attempts fail, and (2) the probability of success is proportional to the similarity between the source and destination states. This augmentation restores conditional conjugacy and admits a simple Gibbs sampler. We evaluate the model and inference method on a speaker diarization task and a \u201charmonic parsing\u201d task using fourpart chorale data, as well as on several synthetic datasets, achieving favorable comparisons to existing models.", "title": "An Infinite Hidden Markov Model With Similarity-Biased Transitions"}